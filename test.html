<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ARQA | –¢–µ–∫—Å–µ—Ä—É “õ“±—Ä–∞–ª–¥–∞—Ä—ã</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
  <style>
    :root{--brand:#02204f;--accent:#4a6fa5;--header-bg:#a7acd9}
    *{box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:#f8faff;margin:0}
    header{width:100%;background:var(--header-bg);position:sticky;top:0;z-index:50;box-shadow:0 6px 18px rgba(0,0,0,.08)}
    .site-nav{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:10px 20px;height:80px}
    .brand{display:flex;align-items:center}
    .nav-logo-img{max-height:60px;width:auto;display:block}
    .nav-panel{display:flex;gap:20px;align-items:center;margin:0;padding:0;list-style:none}
    .nav-panel>li>a{display:flex;align-items:center;gap:6px;padding:8px 12px;color:var(--brand);font-weight:700;transition:color .25s ease,background .25s ease;border-radius:8px;font-size:.95rem}
    .nav-panel>li>a:hover{color:#fff;background:rgba(0,0,0,.12)}
    .has-sub{position:relative}
    .submenu{position:absolute;left:0;top:100%;width:240px;background:#fff;border-radius:8px;padding:10px 0;box-shadow:0 10px 30px rgba(0,0,0,.15);opacity:0;visibility:hidden;transform:translateY(10px);transition:all .28s cubic-bezier(.2,.9,.2,1)}
    .has-sub:hover .submenu,.has-sub:focus-within .submenu{opacity:1;visibility:visible;transform:translateY(0)}
    .submenu li{list-style:none}
    .submenu a{display:block;padding:10px 20px;color:var(--brand);font-weight:500;font-size:.95rem}
    .submenu a:hover{background:#f0f4f8;color:var(--accent)}
    .has-sub-right{position:relative}
    .submenu-right{position:absolute;left:100%;top:0;width:200px;background:#fff;border-radius:8px;padding:10px 0;box-shadow:0 10px 30px rgba(0,0,0,.15);opacity:0;visibility:hidden;transition:all .25s ease}
    .has-sub-right:hover .submenu-right,.has-sub-right:focus-within .submenu-right{opacity:1;visibility:visible}
    @media (max-width:720px){
      .site-nav{flex-direction:column;height:auto;padding:15px}
      .nav-panel{flex-direction:column;width:100%;gap:10px;margin-top:12px}
      .submenu,.submenu-right{position:static;box-shadow:none;padding-left:12px;display:none}
      .has-sub:hover .submenu{display:block;opacity:1;visibility:visible;transform:none}
    }
    .tab-btn{transition:all .2s;border-bottom:3px solid transparent}
    .tab-btn.active{border-color:#6a5398;color:#6a5398;font-weight:800}
    .fade-in{animation:fadeIn .35s ease-in}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .quiz-option:checked + label{background:#ede9fe;border-color:#8b5cf6;color:#5b21b6}
    #xray-container{width:100%;max-width:760px;margin:0 auto;display:none}
    #xrayCanvas{width:100%;border:2px dashed #cbd5e1;border-radius:14px;cursor:crosshair;background:#0b1020}
    .tool-btn{border:1px solid #e5e7eb;border-radius:12px;padding:10px 14px;font-weight:800;font-size:.85rem;transition:.15s}
    .tool-btn:hover{background:#f9fafb}
    .tool-btn-primary{background:#111827;color:#fff;border-color:#111827}
    .tool-btn-primary:hover{opacity:.92}
  </style>
</head>

<body class="min-h-screen text-gray-800">

<header>
  <nav class="site-nav" role="navigation" aria-label="–ë–∞—Å—Ç—ã –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
    <div class="brand">
      <a href="index.html" class="logo-link">
        <img src="arqa.png" alt="ARQA Logo" class="nav-logo-img" />
      </a>
    </div>

    <ul class="nav-panel">
      <li class="has-sub">
        <a href="info.html">–°–∫–æ–ª–∏–æ–∑ —Ç—É—Ä–∞–ª—ã <i class="fa-solid fa-chevron-down" style="font-size:.7em;"></i></a>
        <ul class="submenu">
          <li><a href="info.html">–°–∫–æ–ª–∏–æ–∑ –¥–µ–≥–µ–Ω—ñ–º—ñ–∑ –Ω–µ?</a></li>
          <li class="has-sub-right">
            <a href="idiopathic.html" style="display:flex;justify-content:space-between;">
              –°–∫–æ–ª–∏–æ–∑ —Ç“Ø—Ä–ª–µ—Ä—ñ <i class="fa-solid fa-chevron-right" style="font-size:.7em;"></i>
            </a>
            <ul class="submenu-right">
              <li><a href="idiopathic.html">–ò–¥–∏–æ–ø–∞—Ç–∏—è–ª—ã“õ</a></li>
              <li><a href="congenital.html">–¢—É–∞ –±—ñ—Ç—ñ–º</a></li>
              <li><a href="degenerative.html">–î–µ–≥–µ–Ω–µ—Ä–∞—Ç–∏–≤—Ç—ñ</a></li>
              <li><a href="lumbar.html">–ë–µ–ª –æ–º—ã—Ä—Ç“õ–∞–ª—ã</a></li>
              <li><a href="neuromuscular.html">–ù–µ–π—Ä–æ–±“±–ª—à—ã“õ–µ—Ç</a></li>
              <li><a href="syndromic.html">–°–∏–Ω–¥—Ä–æ–º–¥—ã“õ</a></li>
            </ul>
          </li>
          <li><a href="consequences.html">–°–∞–ª–¥–∞—Ä—ã</a></li>
          <li><a href="treatment.html">–ï–º–¥–µ—É –∂–æ–ª–¥–∞—Ä—ã</a></li>
        </ul>
      </li>
      <li><a href="test.html">–¢–µ–∫—Å–µ—Ä—É</a></li>
      <li><a href="exercises.html">–ñ–∞—Ç—Ç—ã“ì—É–ª–∞—Ä</a></li>
      <li><a href="prevention.html">–ê–ª–¥—ã–Ω –∞–ª—É</a></li>
      <li><a href="Helplines.html">–ö–ª–∏–Ω–∏–∫–∞–ª–∞—Ä</a></li>
      <li><a href="About.html">–ë—ñ–∑ –∂–∞–π–ª—ã</a></li>
    </ul>
  </nav>
</header>

<main class="max-w-6xl mx-auto px-4 py-8">
  <h1 class="text-3xl md:text-4xl font-extrabold text-center mb-2 text-gray-900">”®–∑-”©–∑—ñ“£–¥—ñ —Ç–µ–∫—Å–µ—Ä—É “õ“±—Ä–∞–ª–¥–∞—Ä—ã</h1>
  <p class="text-center text-gray-600 mb-8">–°–∏–º–ø—Ç–æ–º–¥–∞—Ä–¥—ã –±–∞“ì–∞–ª–∞—É –∂”ô–Ω–µ —Ä–µ–Ω—Ç–≥–µ–Ω –∞—Ä“õ—ã–ª—ã Cobb –±“±—Ä—ã—à—ã–Ω ”©–ª—à–µ—É</p>

  <div class="flex justify-center space-x-4 mb-8 border-b text-sm md:text-base overflow-x-auto">
    <button type="button" onclick="switchTab('visual')" id="tab-visual" class="tab-btn active px-4 py-2 text-gray-600">üëÄ –ê–π–Ω–∞ & –ê–¥–∞–º—Å</button>
    <button type="button" onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn px-4 py-2 text-gray-600">üìù –°–∏–º–ø—Ç–æ–º-–∫–≤–∏–∑</button>
    <button type="button" onclick="switchTab('xray')" id="tab-xray" class="tab-btn px-4 py-2 text-gray-600">üß™ –†–µ–Ω—Ç–≥–µ–Ω ”©–ª—à–µ—É</button>
  </div>

  <div id="content-visual" class="fade-in">
    <div class="grid md:grid-cols-2 gap-8">
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
        <div class="flex items-center gap-3 mb-4">
          <div class="bg-blue-100 p-3 rounded-full text-blue-600 font-bold text-xl">1</div>
          <h2 class="text-2xl font-bold">–ê–π–Ω–∞ –∞–ª–¥—ã–Ω–¥–∞“ì—ã –±–∞“õ—ã–ª–∞—É</h2>
        </div>
        <p class="text-gray-600 mb-4">–¢“Ø–∑—É —Ç“±—Ä—ã–ø, –¥–µ–Ω–µ–Ω—ñ –∂–æ“ì–∞—Ä—ã–¥–∞–Ω —Ç”©–º–µ–Ω–≥–µ –¥–µ–π—ñ–Ω “õ–∞—Ä–∞–ø —à—ã“ì—ã“£—ã–∑:</p>
        <ul class="space-y-3 text-sm text-gray-700">
          <li class="flex items-start gap-2"><i class="fa-solid fa-triangle-exclamation text-red-500 mt-0.5"></i><span>–ò—ã“õ –¥–µ“£–≥–µ–π—ñ —Ç–µ“£ –µ–º–µ—Å (–±—ñ—Ä –∏—ã“õ –∂–æ“ì–∞—Ä—ã).</span></li>
          <li class="flex items-start gap-2"><i class="fa-solid fa-triangle-exclamation text-red-500 mt-0.5"></i><span>–ñ–∞—É—ã—Ä—ã–Ω–¥–∞—Ä–¥—ã“£ –±—ñ—Ä–µ—É—ñ –∫”©–±—ñ—Ä–µ–∫ —à—ã“ì—ã–ø —Ç“±—Ä–∞–¥—ã.</span></li>
          <li class="flex items-start gap-2"><i class="fa-solid fa-triangle-exclamation text-red-500 mt-0.5"></i><span>–ë–µ–ª —Å—ã–∑—ã“ì—ã/–¥–µ–Ω–µ “õ—ã—Ä—ã –µ–∫—ñ –∂–∞“õ—Ç–∞ ”ô—Ä—Ç“Ø—Ä–ª—ñ.</span></li>
          <li class="flex items-start gap-2"><i class="fa-solid fa-triangle-exclamation text-red-500 mt-0.5"></i><span>–ñ–∞–º–±–∞—Å –¥–µ“£–≥–µ–π—ñ —Ç–µ“£ –µ–º–µ—Å.</span></li>
          <li class="flex items-start gap-2"><i class="fa-solid fa-triangle-exclamation text-red-500 mt-0.5"></i><span>–ë–∞—Å –æ—Ä—Ç–∞“£“ì—ã —Å—ã–∑—ã“õ—Ç–∞–Ω —ã“ì—ã—Å“õ–∞–Ω–¥–∞–π –∫”©—Ä—ñ–Ω–µ–¥—ñ.</span></li>
        </ul>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
        <div class="flex items-center gap-3 mb-4">
          <div class="bg-violet-100 p-3 rounded-full text-violet-600 font-bold text-xl">2</div>
          <h2 class="text-2xl font-bold">–ê–¥–∞–º—Å —Ç–µ—Å—Ç—ñ (–∞–ª“ì–∞ –µ“£–∫–µ—é)</h2>
        </div>
        <p class="text-gray-600 mb-4">–ö”©–º–µ–∫—à—ñ –∞–¥–∞–º –∞—Ä“õ–∞“£—ã–∑–¥—ã –∞—Ä—Ç –∂–∞“õ—Ç–∞–Ω “õ–∞—Ä–∞–π–¥—ã:</p>
        <div class="bg-gray-50 p-4 rounded-xl text-sm text-gray-700 space-y-2">
          <p><strong>1)</strong> –ê—è“õ –∏—ã“õ –∫–µ“£–¥—ñ–≥—ñ–Ω–¥–µ, —Ç—ñ–∑–µ —Ç“Ø–∑—É, “õ–æ–ª —Ç”©–º–µ–Ω —Å–∞–ª–±—ã—Ä–∞–ø —Ç“±—Ä–∞–¥—ã.</p>
          <p><strong>2)</strong> –ë–∞—è—É –∞–ª“ì–∞ –µ“£–∫–µ–π—ñ–ø, –∞—Ä“õ–∞“£—ã–∑–¥—ã ‚Äú–¥”©“£–µ—Å‚Äù “õ—ã–ª—ã–ø “±—Å—Ç–∞–º–∞“£—ã–∑.</p>
          <p><strong>3)</strong> –ë—ñ—Ä –∂–∞“õ “õ–∞–±—ã—Ä“ì–∞/–∂–∞—É—ã—Ä—ã–Ω –∂–æ“ì–∞—Ä—ã—Ä–∞“õ ‚Äú”©—Ä–∫–µ—à‚Äù —Å–∏—è“õ—Ç—ã –∫”©—Ä—ñ–Ω—Å–µ ‚Äî –±“±–ª –º–∞“£—ã–∑–¥—ã –±–µ–ª–≥—ñ.</p>
        </div>
      </div>
    </div>

    <div class="mt-8 bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
      <h3 class="text-xl font-extrabold text-gray-900 mb-2">–ï—Å–∫–µ—Ä—Ç—É</h3>
      <p class="text-sm text-gray-700">“Æ–π–¥–µ–≥—ñ —Ç–µ—Å—Ç—Ç–µ—Ä –∞–ª–¥—ã–Ω –∞–ª–∞ –±–∞“ì–∞–ª–∞—É “Ø—à—ñ–Ω. –ù–∞“õ—Ç—ã “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã “Ø—à—ñ–Ω –¥”ô—Ä—ñ–≥–µ—Ä “õ–∞—Ä–∞—É—ã –∂”ô–Ω–µ “õ–∞–∂–µ—Ç –±–æ–ª—Å–∞ —Ä–µ–Ω—Ç–≥–µ–Ω/”©–ª—à–µ—É “õ–∞–∂–µ—Ç.</p>
    </div>
  </div>

  <div id="content-quiz" class="hidden fade-in max-w-3xl mx-auto">
    <div class="bg-white p-8 rounded-2xl shadow-lg border border-gray-100">
      <h2 class="text-2xl font-extrabold mb-2 text-gray-900">–°–∏–º–ø—Ç–æ–º-–∫–≤–∏–∑</h2>
      <p class="text-sm text-gray-600 mb-6">–°–æ“£“ì—ã 3 –∞–π–¥–∞“ì—ã –∂–∞“ì–¥–∞–π–¥—ã –±–µ–ª–≥—ñ–ª–µ“£—ñ–∑.</p>

      <form id="scoliosisQuiz" onsubmit="calculateQuiz(event)">
        <div class="space-y-6">

          <div>
            <p class="font-bold text-lg mb-3">1. –ë—ñ—Ä –∏—ã“õ –∞–π“õ—ã–Ω –∂–æ“ì–∞—Ä—ã –∫”©—Ä—ñ–Ω–µ –º–µ?</p>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="radio" id="q1y" name="q1" value="yes" class="hidden quiz-option" required><label for="q1y" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ò”ô</label></div>
              <div><input type="radio" id="q1n" name="q1" value="no" class="hidden quiz-option"><label for="q1n" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ñ–æ“õ</label></div>
            </div>
          </div>

          <div>
            <p class="font-bold text-lg mb-3">2. –ñ–∞—É—ã—Ä—ã–Ω–¥–∞—Ä–¥—ã“£ –±—ñ—Ä–µ—É—ñ –∫”©–±—ñ—Ä–µ–∫ —à—ã“ì—ã–ø —Ç“±—Ä–∞ –º–∞?</p>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="radio" id="q2y" name="q2" value="yes" class="hidden quiz-option" required><label for="q2y" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ò”ô</label></div>
              <div><input type="radio" id="q2n" name="q2" value="no" class="hidden quiz-option"><label for="q2n" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ñ–æ“õ</label></div>
            </div>
          </div>

          <div>
            <p class="font-bold text-lg mb-3">3. –ë–µ–ª —Å—ã–∑—ã“ì—ã –µ–∫—ñ –∂–∞“õ—Ç–∞ –±—ñ—Ä–¥–µ–π –µ–º–µ—Å –ø–µ (–±—ñ—Ä –∂–∞“õ ‚Äú–æ–π—ã—Å—ã‚Äù —Ç–µ—Ä–µ“£—ñ—Ä–µ–∫)?</p>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="radio" id="q3y" name="q3" value="yes" class="hidden quiz-option" required><label for="q3y" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ò”ô</label></div>
              <div><input type="radio" id="q3n" name="q3" value="no" class="hidden quiz-option"><label for="q3n" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ñ–æ“õ</label></div>
            </div>
          </div>

          <div>
            <p class="font-bold text-lg mb-3">4. –ñ–∞–º–±–∞—Å –¥–µ“£–≥–µ–π—ñ —Ç–µ“£ –µ–º–µ—Å —Å–∏—è“õ—Ç—ã –º–∞?</p>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="radio" id="q4y" name="q4" value="yes" class="hidden quiz-option" required><label for="q4y" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ò”ô</label></div>
              <div><input type="radio" id="q4n" name="q4" value="no" class="hidden quiz-option"><label for="q4n" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ñ–æ“õ</label></div>
            </div>
          </div>

          <div>
            <p class="font-bold text-lg mb-3">5. –ö–∏—ñ–º–Ω—ñ“£ –µ—Ç–µ–≥—ñ/–±–µ–ª–¥—ñ–≥—ñ “õ–∏—Å—ã“õ —Ç“±—Ä–∞ –º–∞?</p>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="radio" id="q5y" name="q5" value="yes" class="hidden quiz-option" required><label for="q5y" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ò”ô</label></div>
              <div><input type="radio" id="q5n" name="q5" value="no" class="hidden quiz-option"><label for="q5n" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ñ–æ“õ</label></div>
            </div>
          </div>

          <div>
            <p class="font-bold text-lg mb-3">6. –ê–ª“ì–∞ –µ“£–∫–µ–π–≥–µ–Ω–¥–µ –∞—Ä“õ–∞ –±—ñ—Ä –∂–∞“õ—Ç–∞–Ω –∂–æ“ì–∞—Ä—ã ‚Äú”©—Ä–∫–µ—à‚Äù –±–æ–ª—ã–ø –∫”©—Ä—ñ–Ω–µ –º–µ?</p>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="radio" id="q6y" name="q6" value="yes" class="hidden quiz-option" required><label for="q6y" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ò”ô</label></div>
              <div><input type="radio" id="q6n" name="q6" value="no" class="hidden quiz-option"><label for="q6n" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ñ–æ“õ</label></div>
            </div>
          </div>

          <div>
            <p class="font-bold text-lg mb-3">7. –ë–∞—Å –æ—Ä—Ç–∞“ì–∞ –¥”ô–ª –∫–µ–ª–º–µ–π, –±—ñ—Ä –∂–∞“õ“õ–∞ —ã“ì—ã—Å“õ–∞–Ω–¥–∞–π –º–∞?</p>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="radio" id="q7y" name="q7" value="yes" class="hidden quiz-option" required><label for="q7y" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ò”ô</label></div>
              <div><input type="radio" id="q7n" name="q7" value="no" class="hidden quiz-option"><label for="q7n" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ñ–æ“õ</label></div>
            </div>
          </div>

          <div>
            <p class="font-bold text-lg mb-3">8. “∞–∑–∞“õ –æ—Ç—ã—Ä“ì–∞–Ω–¥–∞/—Ç“±—Ä“ì–∞–Ω–¥–∞ –∞—Ä“õ–∞ –∞—É—ã—Ä—Å—ã–Ω—É—ã –∂–∏—ñ –±–æ–ª–∞–¥—ã –º–∞?</p>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="radio" id="q8y" name="q8" value="yes" class="hidden quiz-option" required><label for="q8y" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ò”ô</label></div>
              <div><input type="radio" id="q8n" name="q8" value="no" class="hidden quiz-option"><label for="q8n" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ñ–æ“õ</label></div>
            </div>
          </div>

          <div>
            <p class="font-bold text-lg mb-3">9. –ë—ñ—Ä –∂–∞“õ—Ç–∞ —à–∞—Ä—à–∞—É/—Ç–∞—Ä—Ç—ã–ª—É —Å–µ–∑—ñ–º—ñ –∫”©–±—ñ—Ä–µ–∫ –ø–µ (”ô—Å—ñ—Ä–µ—Å–µ –±–µ–ª/–∫–µ—É–¥–µ —Ç“±—Å—ã)?</p>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="radio" id="q9y" name="q9" value="yes" class="hidden quiz-option" required><label for="q9y" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ò”ô</label></div>
              <div><input type="radio" id="q9n" name="q9" value="no" class="hidden quiz-option"><label for="q9n" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ñ–æ“õ</label></div>
            </div>
          </div>

          <div>
            <p class="font-bold text-lg mb-3">10. –î–µ–º—ñ–∫–ø–µ –∂–æ“õ –±–æ–ª—Å–∞ –¥–∞, —Ç–µ–∑ –µ–Ω—Ç—ñ–≥—É/—Ç—ã–Ω—ã—Å—Ç—ã“£ —Ç–∞—Ä—ã–ª—É—ã –±–æ–ª–∞–¥—ã –º–∞?</p>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="radio" id="q10y" name="q10" value="yes" class="hidden quiz-option" required><label for="q10y" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ò”ô</label></div>
              <div><input type="radio" id="q10n" name="q10" value="no" class="hidden quiz-option"><label for="q10n" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ñ–æ“õ</label></div>
            </div>
          </div>

          <div>
            <p class="font-bold text-lg mb-3">11. –û—Ç–±–∞—Å—ã“£—ã–∑–¥–∞ —Å–∫–æ–ª–∏–æ–∑ –¥–∏–∞–≥–Ω–æ–∑—ã –±–∞—Ä –º–∞?</p>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="radio" id="q11y" name="q11" value="yes" class="hidden quiz-option" required><label for="q11y" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ò”ô</label></div>
              <div><input type="radio" id="q11n" name="q11" value="no" class="hidden quiz-option"><label for="q11n" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ñ–æ“õ</label></div>
            </div>
          </div>

          <div>
            <p class="font-bold text-lg mb-3">12. –°–æ“£“ì—ã 6 –∞–π–¥–∞ –∞—Å–∏–º–º–µ—Ç—Ä–∏—è –∫“Ø—à–µ–π–≥–µ–Ω–¥–µ–π —Å–µ–∑—ñ–ª–¥—ñ –º–µ?</p>
            <div class="grid grid-cols-2 gap-4">
              <div><input type="radio" id="q12y" name="q12" value="yes" class="hidden quiz-option" required><label for="q12y" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ò”ô</label></div>
              <div><input type="radio" id="q12n" name="q12" value="no" class="hidden quiz-option"><label for="q12n" class="block text-center p-3 border rounded-xl cursor-pointer hover:bg-gray-50">–ñ–æ“õ</label></div>
            </div>
          </div>

        </div>

        <button type="submit" class="w-full mt-8 bg-violet-600 hover:bg-violet-700 text-white font-extrabold py-3 px-6 rounded-2xl transition shadow-lg">
          –ù”ô—Ç–∏–∂–µ–Ω—ñ –∫”©—Ä—É
        </button>
      </form>

      <div id="quiz-result" class="hidden mt-6 p-5 rounded-2xl border">
        <h3 class="font-extrabold text-xl mb-2" id="quiz-title"></h3>
        <p id="quiz-text" class="text-gray-700 text-sm"></p>
        <div class="mt-4 flex flex-wrap gap-2">
          <a href="exercises.html" class="px-4 py-2 rounded-xl bg-gray-900 text-white font-extrabold text-sm hover:opacity-90 transition">–ñ–∞—Ç—Ç—ã“ì—É–ª–∞—Ä</a>
          <a href="Helplines.html" class="px-4 py-2 rounded-xl border border-gray-200 font-extrabold text-sm hover:bg-gray-50 transition">–ö–ª–∏–Ω–∏–∫–∞–ª–∞—Ä</a>
          <button type="button" onclick="window.scrollTo({top:0,behavior:'smooth'})" class="px-4 py-2 rounded-xl border border-gray-200 font-extrabold text-sm hover:bg-gray-50 transition">–ñ–æ“ì–∞—Ä—ã“ì–∞</button>
        </div>
      </div>
    </div>
  </div>

  <div id="content-xray" class="hidden fade-in">
    <div class="max-w-5xl mx-auto bg-white p-6 rounded-2xl shadow-lg border border-gray-100">
      <div class="text-center mb-6">
        <h2 class="text-2xl font-extrabold mb-2 text-violet-800">–†–µ–Ω—Ç–≥–µ–Ω –∞—Ä“õ—ã–ª—ã Cobb –±“±—Ä—ã—à—ã–Ω ”©–ª—à–µ—É</h2>
        <p class="text-sm text-gray-600 max-w-3xl mx-auto">–°—É—Ä–µ—Ç—Ç—ñ –∂“Ø–∫—Ç–µ“£—ñ–∑. –ï–∫—ñ —Å—ã–∑—ã“õ —Å–∞–ª—ã“£—ã–∑: –µ“£ ‚Äú–∂–æ“ì–∞—Ä“ì—ã‚Äù “õ–∏—Å–∞–π“ì–∞–Ω –æ–º—ã—Ä—Ç“õ–∞–Ω—ã“£ “Ø—Å—Ç—ñ“£–≥—ñ —à–µ—Ç—ñ–Ω–µ –∂”ô–Ω–µ –µ“£ ‚Äú—Ç”©–º–µ–Ω–≥—ñ‚Äù “õ–∏—Å–∞–π“ì–∞–Ω –æ–º—ã—Ä—Ç“õ–∞–Ω—ã“£ –∞—Å—Ç—ã“£“ì—ã —à–µ—Ç—ñ–Ω–µ. –ë“±–ª –Ω”ô—Ç–∏–∂–µ –∞“õ–ø–∞—Ä–∞—Ç—Ç—ã“õ –º–∞“õ—Å–∞—Ç—Ç–∞ “ì–∞–Ω–∞.</p>
      </div>

      <div class="flex flex-col lg:flex-row items-center justify-center gap-3 mb-4">
        <label class="tool-btn cursor-pointer bg-gray-50 inline-flex items-center justify-center gap-2">
          <i class="fa-solid fa-upload"></i><span>–°—É—Ä–µ—Ç –∂“Ø–∫—Ç–µ—É</span>
          <input type="file" id="imageLoader" accept="image/*" class="hidden">
        </label>
        <button type="button" class="tool-btn" id="btnReset"><i class="fa-solid fa-rotate-left mr-2"></i>–¢–∞–∑–∞–ª–∞—É</button>
        <button type="button" class="tool-btn" id="btnZoomIn"><i class="fa-solid fa-magnifying-glass-plus mr-2"></i>“Æ–ª–∫–µ–π—Ç—É</button>
        <button type="button" class="tool-btn" id="btnZoomOut"><i class="fa-solid fa-magnifying-glass-minus mr-2"></i>–ö—ñ—à—ñ—Ä–µ–π—Ç—É</button>
        <button type="button" class="tool-btn" id="btnCenter"><i class="fa-solid fa-crosshairs mr-2"></i>–û—Ä—Ç–∞“ì–∞ –∫–µ–ª—Ç—ñ—Ä—É</button>
        <button type="button" class="tool-btn" id="btnEdges"><i class="fa-solid fa-wand-magic-sparkles mr-2"></i>–ö–æ–Ω—Ç—É—Ä –∫”©–º–µ–∫</button>
      </div>

      <div class="text-center text-sm font-extrabold text-violet-700 mb-2" id="stepIndicator">1-“õ–∞–¥–∞–º: –°—É—Ä–µ—Ç –∂“Ø–∫—Ç–µ“£—ñ–∑</div>
      <div class="text-center text-xs text-gray-500 mb-4" id="xrayStatus"></div>

      <div class="bg-gray-900 rounded-2xl p-4 flex items-center justify-center min-h-[320px]">
        <p id="placeholderText" class="text-gray-400">–°—É—Ä–µ—Ç –æ—Å—ã–Ω–¥–∞ —à—ã“ì–∞–¥—ã</p>
        <div id="xray-container">
          <canvas id="xrayCanvas"></canvas>
        </div>
      </div>

      <div id="angleResult" class="hidden mt-6 p-6 bg-gradient-to-r from-violet-50 to-white border-l-4 border-violet-600 rounded-r-2xl">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
          <div>
            <p class="text-xs text-gray-500 uppercase font-extrabold tracking-wide">”®–ª—à–µ–Ω–≥–µ–Ω Cobb –±“±—Ä—ã—à—ã</p>
            <p class="text-4xl font-extrabold text-gray-900"><span id="degreeValue">0</span>¬∞</p>
          </div>
          <div class="md:text-right">
            <p class="font-extrabold text-lg" id="diagTitle"></p>
            <p class="text-sm text-gray-700 mt-1 max-w-lg" id="diagDesc"></p>
          </div>
        </div>

        <div class="mt-4 flex flex-wrap gap-2">
          <button type="button" id="btnSave" class="tool-btn tool-btn-primary"><i class="fa-solid fa-floppy-disk mr-2"></i>–¢–∞—Ä–∏—Ö“õ–∞ —Å–∞“õ—Ç–∞—É</button>
          <button type="button" id="btnClearHistory" class="tool-btn"><i class="fa-solid fa-trash mr-2"></i>–¢–∞—Ä–∏—Ö—Ç—ã ”©—à—ñ—Ä—É</button>
        </div>

        <div class="mt-4 border-t pt-4">
          <h3 class="font-extrabold text-gray-900 mb-2">”®–ª—à–µ—É —Ç–∞—Ä–∏—Ö—ã</h3>
          <div id="historyList" class="space-y-2 text-sm text-gray-700"></div>
        </div>
      </div>

      <div class="mt-6 text-xs text-gray-600 bg-gray-50 border border-gray-100 rounded-2xl p-4">
        –ë“±–ª “õ“±—Ä–∞–ª –º–µ–¥–∏—Ü–∏–Ω–∞–ª—ã“õ –¥–∏–∞–≥–Ω–æ–∑ “õ–æ–π–º–∞–π–¥—ã. –ê–≤—Ç–æ–º–∞—Ç—Ç—ã –∫–æ–Ω—Ç—É—Ä –∫”©–º–µ–≥—ñ “õ–∞—Ç–µ –±–µ—Ä—É—ñ –º“Ø–º–∫—ñ–Ω, —Å–µ–±–µ–±—ñ —Ä–µ–Ω—Ç–≥–µ–Ω —Å–∞–ø–∞—Å—ã/–±“±—Ä—ã–ª—É—ã/–∂–∞—Ä—ã“õ—Ç—ã–ª—ã“õ ”ô—Å–µ—Ä –µ—Ç–µ–¥—ñ. –ù–∞“õ—Ç—ã ”©–ª—à–µ—É–¥—ñ –º–∞–º–∞–Ω —Ä–∞—Å—Ç–∞—É—ã –∫–µ—Ä–µ–∫.
      </div>
    </div>
  </div>

</main>

<script async src="https://docs.opencv.org/4.x/opencv.js"></script>

<script>
  function switchTab(tabId){
    ["visual","quiz","xray"].forEach(id=>{
      document.getElementById(`content-${id}`).classList.add("hidden");
      document.getElementById(`tab-${id}`).classList.remove("active");
    });
    document.getElementById(`content-${tabId}`).classList.remove("hidden");
    document.getElementById(`tab-${tabId}`).classList.add("active");
  }

  function calculateQuiz(e){
    e.preventDefault();
    const fd = new FormData(document.getElementById("scoliosisQuiz"));
    const weights = {q6:3,q12:2,q1:2,q2:2,q4:2,q8:1,q3:1,q5:1,q7:1,q9:1,q10:2,q11:1};
    let score = 0;
    let yesCount = 0;
    for (const [k,v] of fd.entries()){
      if (v === "yes"){
        yesCount++;
        score += (weights[k] || 1);
      }
    }
    const box = document.getElementById("quiz-result");
    const title = document.getElementById("quiz-title");
    const text = document.getElementById("quiz-text");
    box.classList.remove("hidden");

    if (score <= 2){
      box.className = "mt-6 p-5 rounded-2xl border bg-green-50 border-green-200";
      title.className = "font-extrabold text-xl mb-2 text-green-700";
      title.textContent = "–¢”©–º–µ–Ω “õ–∞—É—ñ–ø";
      text.innerHTML = `–°—ñ–∑–¥–µ <strong>${yesCount}</strong> –±–µ–ª–≥—ñ –±–∞–π“õ–∞–ª–¥—ã. –ë“±–ª –º—ñ–Ω–¥–µ—Ç—Ç—ñ —Ç“Ø—Ä–¥–µ —Å–∫–æ–ª–∏–æ–∑ –¥–µ–≥–µ–Ω —Å”©–∑ –µ–º–µ—Å. –î–µ–≥–µ–Ω–º–µ–Ω –¥“±—Ä—ã—Å “õ–∞–ª—ã–ø, —Ç“±—Ä–∞“õ—Ç—ã —Å–æ–∑—ã–ª—É –∂”ô–Ω–µ –∞—Ä“õ–∞ –±“±–ª—à—ã“õ–µ—Ç—ñ–Ω –∫“Ø—à–µ–π—Ç—É –ø–∞–π–¥–∞–ª—ã.`;
    } else if (score <= 6){
      box.className = "mt-6 p-5 rounded-2xl border bg-yellow-50 border-yellow-200";
      title.className = "font-extrabold text-xl mb-2 text-yellow-700";
      title.textContent = "–û—Ä—Ç–∞—à–∞ “õ–∞—É—ñ–ø";
      text.innerHTML = `–°—ñ–∑–¥–µ <strong>${yesCount}</strong> –±–µ–ª–≥—ñ –±–∞—Ä. “ö–∞–ª—ã–ø –ø–µ–Ω –±“±–ª—à—ã“õ–µ—Ç —Ç–µ“£–≥–µ—Ä—ñ–º—Å—ñ–∑–¥—ñ–≥—ñ –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω. –ê–¥–∞–º—Å —Ç–µ—Å—Ç—ñ–Ω “õ–∞–π—Ç–∞ —Ç–µ–∫—Å–µ—Ä—ñ–ø, “õ–∞–∂–µ—Ç –±–æ–ª—Å–∞ –¥”ô—Ä—ñ–≥–µ—Ä–≥–µ –∫”©—Ä—ñ–Ω–≥–µ–Ω –¥“±—Ä—ã—Å.`;
    } else {
      box.className = "mt-6 p-5 rounded-2xl border bg-red-50 border-red-200";
      title.className = "font-extrabold text-xl mb-2 text-red-700";
      title.textContent = "–ñ–æ“ì–∞—Ä—ã “õ–∞—É—ñ–ø";
      text.innerHTML = `–°—ñ–∑–¥–µ <strong>${yesCount}</strong> –±–µ–ª–≥—ñ –∞–Ω—ã“õ—Ç–∞–ª–¥—ã. –ù–∞“õ—Ç—ã–ª–∞—É “Ø—à—ñ–Ω –æ—Ä—Ç–æ–ø–µ–¥–∫–µ “õ–∞—Ä–∞–ª—ã–ø, –¥”ô—Ä—ñ–≥–µ—Ä “±—Å—ã–Ω—Å–∞ —Ä–µ–Ω—Ç–≥–µ–Ω –∂–∞—Å–∞—Ç—É –º–∞“£—ã–∑–¥—ã. –†–µ–Ω—Ç–≥–µ–Ω –±–æ–ª—Å–∞, —Ç”©–º–µ–Ω–¥–µ–≥—ñ ‚Äú–†–µ–Ω—Ç–≥–µ–Ω ”©–ª—à–µ—É‚Äù –±”©–ª—ñ–º—ñ–Ω–¥–µ –±“±—Ä—ã—à—Ç—ã –µ—Å–µ–ø—Ç–µ–ø –∫”©—Ä–µ –∞–ª–∞—Å—ã–∑ (–∞“õ–ø–∞—Ä–∞—Ç—Ç—ã“õ –º–∞“õ—Å–∞—Ç—Ç–∞).`;
    }
  }

  const imageLoader = document.getElementById("imageLoader");
  const canvas = document.getElementById("xrayCanvas");
  const ctx = canvas.getContext("2d");
  const container = document.getElementById("xray-container");
  const placeholderText = document.getElementById("placeholderText");
  const stepIndicator = document.getElementById("stepIndicator");
  const xrayStatus = document.getElementById("xrayStatus");

  const btnReset = document.getElementById("btnReset");
  const btnZoomIn = document.getElementById("btnZoomIn");
  const btnZoomOut = document.getElementById("btnZoomOut");
  const btnCenter = document.getElementById("btnCenter");
  const btnEdges = document.getElementById("btnEdges");
  const angleResult = document.getElementById("angleResult");
  const degreeValue = document.getElementById("degreeValue");
  const diagTitle = document.getElementById("diagTitle");
  const diagDesc = document.getElementById("diagDesc");
  const btnSave = document.getElementById("btnSave");
  const btnClearHistory = document.getElementById("btnClearHistory");
  const historyList = document.getElementById("historyList");

  let img = new Image();
  let imgLoaded = false;

  let scale = 1;
  let offsetX = 0;
  let offsetY = 0;

  let dragging = false;
  let dragStart = null;

  let clicks = [];
  let lines = [];

  let edgesEnabled = false;
  let edgesMask = null;
  let edgesW = 0;
  let edgesH = 0;

  function setStatus(s){ xrayStatus.textContent = s || ""; }

  function fitCanvasToContainer(){
    const w = Math.min(760, container.clientWidth || 760);
    const ratio = img.height / img.width;
    canvas.width = Math.floor(w);
    canvas.height = Math.floor(w * ratio);
  }

  function resetView(){
    scale = 1;
    offsetX = 0;
    offsetY = 0;
  }

  function drawBase(){
    ctx.setTransform(1,0,0,1,0,0);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "#0b1020";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.setTransform(scale,0,0,scale,offsetX,offsetY);
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    if (edgesEnabled && edgesMask){
      const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
      const data = imageData.data;
      for (let y=0; y<edgesH; y++){
        for (let x=0; x<edgesW; x++){
          const v = edgesMask[y*edgesW + x];
          if (v){
            const i = (y*edgesW + x)*4;
            data[i] = 255;
            data[i+1] = 255;
            data[i+2] = 0;
            data[i+3] = 160;
          }
        }
      }
      ctx.putImageData(imageData,0,0);
    }

    ctx.setTransform(scale,0,0,scale,offsetX,offsetY);

    ctx.lineWidth = 3/scale;
    ctx.strokeStyle = "#ef4444";
    ctx.fillStyle = "#ef4444";

    const drawPoint = (p) => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 4/scale, 0, Math.PI*2);
      ctx.fill();
    };

    lines.forEach(L => {
      drawPoint(L[0]); drawPoint(L[1]);
      ctx.beginPath();
      ctx.moveTo(L[0].x, L[0].y);
      ctx.lineTo(L[1].x, L[1].y);
      ctx.stroke();
    });

    clicks.forEach(drawPoint);
  }

  function resetAll(){
    clicks = [];
    lines = [];
    angleResult.classList.add("hidden");
    stepIndicator.textContent = imgLoaded ? "2-“õ–∞–¥–∞–º: –ñ–û“í–ê–†“í–´ —Å—ã–∑—ã“õ—Ç—ã“£ 1-–Ω“Ø–∫—Ç–µ—Å—ñ–Ω “õ–æ–π—ã“£—ã–∑" : "1-“õ–∞–¥–∞–º: –°—É—Ä–µ—Ç –∂“Ø–∫—Ç–µ“£—ñ–∑";
    setStatus("");
    drawBase();
  }

  function toWorld(clientX, clientY){
    const rect = canvas.getBoundingClientRect();
    const x = (clientX - rect.left - offsetX) / scale;
    const y = (clientY - rect.top - offsetY) / scale;
    return {x, y};
  }

  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

  function snapToEdge(p){
    if (!edgesEnabled || !edgesMask) return p;
    const x0 = Math.round(p.x);
    const y0 = Math.round(p.y);
    const r = Math.round(14 / scale);
    let best = null;
    let bestD = 1e9;

    const xmin = clamp(x0 - r, 0, edgesW - 1);
    const xmax = clamp(x0 + r, 0, edgesW - 1);
    const ymin = clamp(y0 - r, 0, edgesH - 1);
    const ymax = clamp(y0 + r, 0, edgesH - 1);

    for (let y=ymin; y<=ymax; y++){
      const row = y*edgesW;
      for (let x=xmin; x<=xmax; x++){
        if (edgesMask[row + x]){
          const dx = x - x0;
          const dy = y - y0;
          const d = dx*dx + dy*dy;
          if (d < bestD){
            bestD = d;
            best = {x, y};
          }
        }
      }
    }
    return best ? {x: best.x, y: best.y} : p;
  }

  function angleDeg(L){
    return Math.atan2(L[1].y - L[0].y, L[1].x - L[0].x) * 180 / Math.PI;
  }

  function computeCobb(){
    const L1 = lines[0];
    const L2 = lines[1];
    const a1 = Math.atan2(L1[1].y - L1[0].y, L1[1].x - L1[0].x);
    const a2 = Math.atan2(L2[1].y - L2[0].y, L2[1].x - L2[0].x);
    let deg = Math.abs((a1 - a2) * 180 / Math.PI);
    if (deg > 90) deg = 180 - deg;
    return Math.round(deg);
  }

  function setDiagnosis(deg){
    if (deg < 10){
      diagTitle.className = "font-extrabold text-lg text-green-600";
      diagTitle.textContent = "10¬∞-—Ç–∞–Ω —Ç”©–º–µ–Ω";
      diagDesc.textContent = "–ö”©–±—ñ–Ω–µ –∫–ª–∏–Ω–∏–∫–∞–ª—ã“õ —Å–∫–æ–ª–∏–æ–∑ —Ä–µ—Ç—ñ–Ω–¥–µ –µ—Å–µ–ø—Ç–µ–ª–º–µ–π–¥—ñ. –î“±—Ä—ã—Å “õ–∞–ª—ã–ø, –±–∞“õ—ã–ª–∞—É –∂”ô–Ω–µ –∂–µ“£—ñ–ª –∂–∞—Ç—Ç—ã“ì—É–ª–∞—Ä –∂–µ—Ç–∫—ñ–ª—ñ–∫—Ç—ñ –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω.";
      return;
    }
    if (deg < 20){
      diagTitle.className = "font-extrabold text-lg text-yellow-600";
      diagTitle.textContent = "–ñ–µ“£—ñ–ª “õ–∏—Å–∞—é (10‚Äì19¬∞)";
      diagDesc.textContent = "–ë–∞“õ—ã–ª–∞—É –∂”ô–Ω–µ –∞—Ä–Ω–∞–π—ã –∂–∞—Ç—Ç—ã“ì—É–ª–∞—Ä –ø–∞–π–¥–∞–ª—ã. –ú–∞–º–∞–º–µ–Ω –∫–µ“£–µ—Å–∫–µ–Ω –¥“±—Ä—ã—Å.";
      return;
    }
    if (deg < 40){
      diagTitle.className = "font-extrabold text-lg text-orange-600";
      diagTitle.textContent = "–û—Ä—Ç–∞—à–∞ “õ–∏—Å–∞—é (20‚Äì39¬∞)";
      diagDesc.textContent = "–î”ô—Ä—ñ–≥–µ—Ä –±–∞“õ—ã–ª–∞—É—ã –º–∞“£—ã–∑–¥—ã. –ö–µ–π –∂–∞“ì–¥–∞–π–ª–∞—Ä–¥–∞ –∫–æ—Ä—Å–µ—Ç –∂”ô–Ω–µ –∂“Ø–π–µ–ª—ñ —Ç–µ—Ä–∞–ø–∏—è “õ–∞–∂–µ—Ç –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω.";
      return;
    }
    diagTitle.className = "font-extrabold text-lg text-red-600";
    diagTitle.textContent = "–ê–π“õ—ã–Ω “õ–∏—Å–∞—é (40¬∞+)";
    diagDesc.textContent = "–ú–∞–º–∞–Ω–¥–∞–Ω“ì–∞–Ω –æ—Ä—Ç–æ–ø–µ–¥/–≤–µ—Ä—Ç–µ–±—Ä–æ–ª–æ–≥“õ–∞ —à“±“ì—ã–ª “õ–∞—Ä–∞–ª“ì–∞–Ω –∂”©–Ω. –ï–º —Ç–∞–∫—Ç–∏–∫–∞—Å—ã–Ω –¥”ô—Ä—ñ–≥–µ—Ä –∞–Ω—ã“õ—Ç–∞–π–¥—ã.";
  }

  function renderHistory(){
    const items = JSON.parse(localStorage.getItem("arqa_cobb_history") || "[]");
    if (!items.length){
      historyList.innerHTML = '<div class="text-gray-500">–¢–∞—Ä–∏—Ö –±–æ—Å</div>';
      return;
    }
    historyList.innerHTML = items.map(it => {
      return `<div class="flex items-center justify-between rounded-xl border border-gray-100 bg-white p-3">
        <div>
          <div class="font-extrabold text-gray-900">${it.deg}¬∞</div>
          <div class="text-xs text-gray-500">${it.date}</div>
        </div>
        <div class="text-xs text-gray-600">Cobb</div>
      </div>`;
    }).join("");
  }

  function saveToHistory(deg){
    const items = JSON.parse(localStorage.getItem("arqa_cobb_history") || "[]");
    const d = new Date();
    const date = `${String(d.getDate()).padStart(2,"0")}.${String(d.getMonth()+1).padStart(2,"0")}.${d.getFullYear()} ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
    items.unshift({deg, date});
    localStorage.setItem("arqa_cobb_history", JSON.stringify(items.slice(0, 20)));
    renderHistory();
  }

  async function buildEdges(){
    if (!window.cv || !cv.imread){
      setStatus("–ö–æ–Ω—Ç—É—Ä –∫”©–º–µ–∫ “õ–æ–ª–∂–µ—Ç—ñ–º—Å—ñ–∑.");
      return;
    }
    setStatus("–ö–æ–Ω—Ç—É—Ä ”©“£–¥–µ–ª—ñ–ø –∂–∞—Ç—ã—Ä...");
    edgesMask = null;

    const tmp = document.createElement("canvas");
    tmp.width = canvas.width;
    tmp.height = canvas.height;
    const tctx = tmp.getContext("2d");
    tctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    const src = cv.imread(tmp);
    const gray = new cv.Mat();
    cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY, 0);
    const blur = new cv.Mat();
    cv.GaussianBlur(gray, blur, new cv.Size(5,5), 0, 0, cv.BORDER_DEFAULT);
    const edges = new cv.Mat();
    cv.Canny(blur, edges, 60, 140);

    edgesW = edges.cols;
    edgesH = edges.rows;
    edgesMask = new Uint8Array(edgesW * edgesH);
    for (let y=0; y<edgesH; y++){
      for (let x=0; x<edgesW; x++){
        edgesMask[y*edgesW + x] = edges.ucharPtr(y, x)[0] > 0 ? 1 : 0;
      }
    }

    src.delete(); gray.delete(); blur.delete(); edges.delete();
    setStatus("–ö–æ–Ω—Ç—É—Ä –∫”©–º–µ–∫ “õ–æ—Å—ã–ª–¥—ã.");
    drawBase();
  }

  imageLoader.addEventListener("change", (e)=>{
    const f = e.target.files && e.target.files[0];
    if (!f) return;

    const reader = new FileReader();
    reader.onload = (ev)=>{
      img.onload = ()=>{
        imgLoaded = true;
        placeholderText.style.display = "none";
        container.style.display = "block";
        fitCanvasToContainer();
        resetView();
        edgesEnabled = false;
        edgesMask = null;
        stepIndicator.textContent = "2-“õ–∞–¥–∞–º: –ñ–û“í–ê–†“í–´ —Å—ã–∑—ã“õ—Ç—ã“£ 1-–Ω“Ø–∫—Ç–µ—Å—ñ–Ω “õ–æ–π—ã“£—ã–∑";
        setStatus("");
        resetAll();
        renderHistory();
      };
      img.src = ev.target.result;
    };
    reader.readAsDataURL(f);
  });

  canvas.addEventListener("mousedown", (e)=>{
    if (!imgLoaded) return;
    if (e.button !== 0) return;

    if (e.shiftKey){
      dragging = true;
      dragStart = {x: e.clientX, y: e.clientY, ox: offsetX, oy: offsetY};
      return;
    }

    if (lines.length >= 2) return;

    const p0 = toWorld(e.clientX, e.clientY);
    const p = snapToEdge({x:p0.x, y:p0.y});

    clicks.push(p);

    if (lines.length === 0){
      if (clicks.length === 1) stepIndicator.textContent = "–ñ–û“í–ê–†“í–´ —Å—ã–∑—ã“õ—Ç—ã“£ 2-–Ω“Ø–∫—Ç–µ—Å—ñ–Ω “õ–æ–π—ã“£—ã–∑";
      if (clicks.length === 2){
        lines.push([clicks[0], clicks[1]]);
        clicks = [];
        stepIndicator.textContent = "3-“õ–∞–¥–∞–º: –¢”®–ú–ï–ù–ì–Ü —Å—ã–∑—ã“õ—Ç—ã“£ 1-–Ω“Ø–∫—Ç–µ—Å—ñ–Ω “õ–æ–π—ã“£—ã–∑";
      }
    } else {
      if (clicks.length === 1) stepIndicator.textContent = "–¢”®–ú–ï–ù–ì–Ü —Å—ã–∑—ã“õ—Ç—ã“£ 2-–Ω“Ø–∫—Ç–µ—Å—ñ–Ω “õ–æ–π—ã“£—ã–∑";
      if (clicks.length === 2){
        lines.push([clicks[0], clicks[1]]);
        clicks = [];
        const deg = computeCobb();
        degreeValue.textContent = deg;
        setDiagnosis(deg);
        angleResult.classList.remove("hidden");
        stepIndicator.textContent = "–ù”ô—Ç–∏–∂–µ –¥–∞–π—ã–Ω";
      }
    }
    drawBase();
  });

  canvas.addEventListener("mousemove", (e)=>{
    if (!dragging || !dragStart) return;
    const dx = e.clientX - dragStart.x;
    const dy = e.clientY - dragStart.y;
    offsetX = dragStart.ox + dx;
    offsetY = dragStart.oy + dy;
    drawBase();
  });

  window.addEventListener("mouseup", ()=>{
    dragging = false;
    dragStart = null;
  });

  btnReset.addEventListener("click", ()=>{
    if (!imgLoaded) return;
    resetAll();
  });

  btnZoomIn.addEventListener("click", ()=>{
    if (!imgLoaded) return;
    scale = Math.min(4, scale * 1.18);
    drawBase();
  });

  btnZoomOut.addEventListener("click", ()=>{
    if (!imgLoaded) return;
    scale = Math.max(0.6, scale / 1.18);
    drawBase();
  });

  btnCenter.addEventListener("click", ()=>{
    if (!imgLoaded) return;
    resetView();
    drawBase();
  });

  btnEdges.addEventListener("click", async ()=>{
    if (!imgLoaded) return;
    edgesEnabled = !edgesEnabled;
    if (!edgesEnabled){
      edgesMask = null;
      setStatus("–ö–æ–Ω—Ç—É—Ä –∫”©–º–µ–∫ ”©—à—ñ—Ä—ñ–ª–¥—ñ.");
      drawBase();
      return;
    }
    if (window.cv && cv.imread){
      await buildEdges();
    } else {
      setStatus("–ö–æ–Ω—Ç—É—Ä –º–æ–¥—É–ª—ñ –∂“Ø–∫—Ç–µ–ª—ñ–ø –∂–∞—Ç—ã—Ä...");
      const start = Date.now();
      const timer = setInterval(async ()=>{
        if (window.cv && cv.imread){
          clearInterval(timer);
          await buildEdges();
          return;
        }
        if (Date.now() - start > 12000){
          clearInterval(timer);
          edgesEnabled = false;
          setStatus("–ö–æ–Ω—Ç—É—Ä –º–æ–¥—É–ª—ñ –∂“Ø–∫—Ç–µ–ª–º–µ–¥—ñ.");
        }
      }, 350);
    }
  });

  btnSave.addEventListener("click", ()=>{
    const deg = Number(degreeValue.textContent || "0");
    if (!deg) return;
    saveToHistory(deg);
    setStatus("–¢–∞—Ä–∏—Ö“õ–∞ —Å–∞“õ—Ç–∞–ª–¥—ã.");
  });

  btnClearHistory.addEventListener("click", ()=>{
    localStorage.removeItem("arqa_cobb_history");
    renderHistory();
    setStatus("–¢–∞—Ä–∏—Ö ”©—à—ñ—Ä—ñ–ª–¥—ñ.");
  });

  window.addEventListener("resize", ()=>{
    if (!imgLoaded) return;
    fitCanvasToContainer();
    drawBase();
  });

  renderHistory();
</script>

</body>
</html>
