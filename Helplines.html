<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ARQA | –ö–ª–∏–Ω–∏–∫–∞–ª–∞—Ä</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>

  <style>
    :root{--brand:#02204f;--accent:#4a6fa5;--header-bg:#a7acd9}
    *{box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:#f8faff;color:#111827;margin:0}
    a{color:var(--accent);text-decoration:none}
    header{width:100%;background:var(--header-bg);box-shadow:0 2px 10px rgba(0,0,0,.1);position:relative;z-index:1000}
    .site-nav{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:10px 20px;height:80px}
    .brand{display:flex;align-items:center}
    .nav-logo-img{max-height:60px;width:auto;display:block}
    .nav-panel{display:flex;gap:20px;align-items:center;margin:0;padding:0;list-style:none}
    .nav-panel>li>a{display:flex;align-items:center;gap:6px;padding:8px 12px;color:var(--brand);font-weight:700;transition:color .2s;border-radius:8px}
    .nav-panel>li>a:hover{color:#fff;background:rgba(0,0,0,.12)}
    .has-sub{position:relative}
    .submenu{position:absolute;left:0;top:100%;width:240px;background:#fff;border-radius:8px;padding:10px 0;box-shadow:0 10px 30px rgba(0,0,0,.15);opacity:0;visibility:hidden;transform:translateY(10px);transition:all .2s ease;z-index:120}
    .has-sub:hover .submenu,.has-sub:focus-within .submenu{opacity:1;visibility:visible;transform:translateY(0)}
    .submenu li{list-style:none}
    .submenu a{display:block;padding:10px 20px;color:var(--brand);font-weight:500;font-size:.95rem}
    .submenu a:hover{background:#f0f4f8;color:var(--accent)}
    .has-sub-right{position:relative}
    .submenu-right{position:absolute;left:100%;top:0;width:200px;background:#fff;border-radius:8px;padding:10px 0;box-shadow:0 10px 30px rgba(0,0,0,.15);opacity:0;visibility:hidden;transition:all .2s ease;z-index:140}
    .has-sub-right:hover .submenu-right,.has-sub-right:focus-within .submenu-right{opacity:1;visibility:visible}
    #map{width:100%;height:460px;border-radius:16px;overflow:hidden}
    .city-btn.active{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 10px 18px rgba(74,111,165,.25)}
    @media (max-width:768px){
      .site-nav{flex-direction:column;height:auto;padding:15px}
      .nav-panel{flex-direction:column;width:100%;gap:10px;margin-top:15px}
      .submenu,.submenu-right{position:static;box-shadow:none;padding-left:20px;display:none}
      .has-sub:hover .submenu{display:block;opacity:1;visibility:visible;transform:none}
      #map{height:380px}
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">

<header>
  <nav class="site-nav" role="navigation" aria-label="–ë–∞—Å—Ç—ã –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
    <div class="brand">
      <a href="index.html" class="logo-link">
        <img src="arqa.png" alt="ARQA Logo" class="nav-logo-img" />
      </a>
    </div>

    <ul class="nav-panel">
      <li class="has-sub">
        <a href="info.html">–°–∫–æ–ª–∏–æ–∑ —Ç—É—Ä–∞–ª—ã <i class="fa-solid fa-chevron-down" style="font-size:.7em;"></i></a>
        <ul class="submenu">
          <li><a href="info.html">–°–∫–æ–ª–∏–æ–∑ –¥–µ–≥–µ–Ω—ñ–º—ñ–∑ –Ω–µ?</a></li>
          <li class="has-sub-right">
            <a href="idiopathic.html" style="display:flex;justify-content:space-between;">
              –°–∫–æ–ª–∏–æ–∑ —Ç“Ø—Ä–ª–µ—Ä—ñ <i class="fa-solid fa-chevron-right" style="font-size:.7em;"></i>
            </a>
            <ul class="submenu-right">
              <li><a href="idiopathic.html">–ò–¥–∏–æ–ø–∞—Ç–∏—è–ª—ã“õ</a></li>
              <li><a href="congenital.html">–¢—É–∞ –±—ñ—Ç—ñ–º</a></li>
              <li><a href="degenerative.html">–î–µ–≥–µ–Ω–µ—Ä–∞—Ç–∏–≤—Ç—ñ</a></li>
              <li><a href="lumbar.html">–ë–µ–ª –æ–º—ã—Ä—Ç“õ–∞–ª—ã</a></li>
              <li><a href="neuromuscular.html">–ù–µ–π—Ä–æ–±“±–ª—à—ã“õ–µ—Ç</a></li>
              <li><a href="syndromic.html">–°–∏–Ω–¥—Ä–æ–º–¥—ã“õ</a></li>
            </ul>
          </li>
          <li><a href="consequences.html">–°–∞–ª–¥–∞—Ä—ã</a></li>
          <li><a href="treatment.html">–ï–º–¥–µ—É –∂–æ–ª–¥–∞—Ä—ã</a></li>
        </ul>
      </li>
      <li><a href="test.html">–¢–µ–∫—Å–µ—Ä—É</a></li>
      <li><a href="exercises.html">–ñ–∞—Ç—Ç—ã“ì—É–ª–∞—Ä</a></li>
      <li><a href="prevention.html">–ê–ª–¥—ã–Ω –∞–ª—É</a></li>
      <li><a href="Helplines.html">–ö–ª–∏–Ω–∏–∫–∞–ª–∞—Ä</a></li>
      <li><a href="About.html">–ë—ñ–∑ –∂–∞–π–ª—ã</a></li>
    </ul>
  </nav>
</header>

<main class="flex-grow container mx-auto px-4 py-8 max-w-7xl">

  <div class="text-center mb-8">
    <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900">üè• –ö”©–º–µ–∫ –∞–ª—É: –ú–µ–¥–∏—Ü–∏–Ω–∞–ª—ã“õ –æ—Ä—Ç–∞–ª—ã“õ—Ç–∞—Ä</h1>
    <p class="text-gray-600 mt-2 max-w-3xl mx-auto">
      “ö–∞–∑–∞“õ—Å—Ç–∞–Ω –±–æ–π—ã–Ω—à–∞ —Å–∫–æ–ª–∏–æ–∑–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞–ª–∞—É“ì–∞, –µ–º–¥–µ—É–≥–µ –∂”ô–Ω–µ –æ“£–∞–ª—Ç—É“ì–∞ –º–∞–º–∞–Ω–¥–∞–Ω“ì–∞–Ω –æ—Ä—Ç–∞–ª—ã“õ—Ç–∞—Ä–¥—ã“£ —Ç—ñ–∑—ñ–º—ñ. –ë–∞—Ä–ª—ã“õ –∞“õ–ø–∞—Ä–∞—Ç 2GIS –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω–µ –Ω–µ–≥—ñ–∑–¥–µ–ª–≥–µ–Ω.
    </p>
  </div>

  <section class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 md:p-6 mb-8">
    <div class="flex flex-col lg:flex-row gap-4 lg:items-center lg:justify-between">
      <div id="cityButtons" class="flex flex-wrap gap-2"></div>

      <div class="flex flex-col sm:flex-row gap-3 sm:items-center w-full lg:w-auto">
        <div class="relative w-full sm:w-96">
          <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
          <input id="searchInput" type="text"
                 class="w-full pl-10 pr-4 py-2.5 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-[rgba(74,111,165,.35)]"
                 placeholder="–ê—Ç–∞—É—ã –Ω–µ–º–µ—Å–µ –º–µ–∫–µ–Ω–∂–∞–π –±–æ–π—ã–Ω—à–∞ —ñ–∑–¥–µ—É..." />
        </div>

        <button id="nearMeBtn"
                class="px-4 py-2.5 rounded-xl bg-gray-900 text-white font-bold text-sm hover:opacity-90 transition w-full sm:w-auto">
          <i class="fa-solid fa-location-crosshairs mr-2"></i> –ñ–∞“õ—ã–Ω–¥–∞—Ä—ã–Ω –∫”©—Ä—Å–µ—Ç—É
        </button>
      </div>
    </div>

    <div class="mt-3 text-sm text-gray-600" id="statusLine"></div>
  </section>

  <section class="grid lg:grid-cols-2 gap-6 items-start">
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 md:p-5">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-extrabold text-gray-900" id="mapTitle"></h2>
        <span class="text-sm text-gray-500" id="countBadge"></span>
      </div>
      <div id="map"></div>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 md:p-5">
      <h2 class="text-xl font-extrabold text-gray-900 mb-3">–¢—ñ–∑—ñ–º</h2>
      <div id="clinicList" class="space-y-4"></div>
      <div id="emptyBox" class="hidden mt-4 rounded-2xl border border-amber-200 bg-amber-50 p-4 text-amber-900 text-sm">
        –ù”ô—Ç–∏–∂–µ —Ç–∞–±—ã–ª–º–∞–¥—ã. –Ü–∑–¥–µ—É–¥—ñ ”©–∑–≥–µ—Ä—Ç—ñ“£—ñ–∑ –Ω–µ–º–µ—Å–µ –±–∞—Å“õ–∞ “õ–∞–ª–∞–Ω—ã —Ç–∞“£–¥–∞“£—ã–∑.
      </div>
    </div>
  </section>

</main>

<footer class="bg-gray-50 border-t py-8 mt-10">
  <div class="text-center text-gray-500 text-sm">
    <p>&copy; 2023 ARQA Project. –î–µ–Ω—ñ —Å–∞—É “±–ª—Ç ‚Äî “õ—É–∞—Ç—Ç—ã –º–µ–º–ª–µ–∫–µ—Ç.</p>
  </div>
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

<script>
  const cityCenters = {
    astana: { name: "–ê—Å—Ç–∞–Ω–∞", center: [51.1282, 71.4304], zoom: 12 },
    almaty: { name: "–ê–ª–º–∞—Ç—ã", center: [43.2383, 76.9455], zoom: 12 },
    shymkent: { name: "–®—ã–º–∫–µ–Ω—Ç", center: [42.3417, 69.5901], zoom: 12 },
    karagandy: { name: "“ö–∞—Ä–∞“ì–∞–Ω–¥—ã", center: [49.8064, 73.0855], zoom: 12 },
    taraz: { name: "–¢–∞—Ä–∞–∑", center: [42.9015, 71.3645], zoom: 12 },
    atyrau: { name: "–ê—Ç—ã—Ä–∞—É", center: [47.0945, 51.9230], zoom: 12 },
    aktau: { name: "–ê“õ—Ç–∞—É", center: [43.6511, 51.1975], zoom: 12 },
    oskemen: { name: "”®—Å–∫–µ–º–µ–Ω", center: [49.9483, 82.6285], zoom: 12 },
    semey: { name: "–°–µ–º–µ–π", center: [50.4111, 80.2275], zoom: 12 },
    pavlodar: { name: "–ü–∞–≤–ª–æ–¥–∞—Ä", center: [52.2873, 76.9674], zoom: 12 }
  };

  const clinics = [
    {"city":"astana","name":"–≠–ú–ò–†–ú–ï–î","address":"–ö—É–π—à–∏ –î–∏–Ω–∞ –∫”©—à–µ—Å—ñ, 9, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 708 911 05 96, +7 747 000 01 03","hours":"24/7","link":"emirmed.kz"},
    {"city":"astana","name":"—ç–º–∏—Ä–º–µ–¥","address":"–°–∞—É—Ä–∞–Ω, 1, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"","hours":"","link":"https://2gis.kz/astana/geo/70000001106037513"},
    {"city":"astana","name":"Lucem medical clinic","address":"–ê–º–∞–Ω–∞—Ç, 2, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 747 947 91 94","hours":"24/7","link":"https://2gis.kz/astana/geo/70000001037651642"},
    {"city":"astana","name":"Ais m√´d","address":"–†–æ–∑–∞ –ë–∞–≥–ª–∞–Ω–æ–≤–∞ 4, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 701 800 59 91","hours":"10:00-21:00","link":"https://2gis.kz/astana/geo/70000001046215558"},
    {"city":"astana","name":"–ê–∫–∞–¥–µ–º–∏—è –æ—Ä—Ç–æ–ø–µ–¥–∏–∏","address":"–ü–µ—Ç—Ä–æ–≤–∞ 25, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 717 236 42 05","hours":"9-19","link":"https://2gis.kz/astana/geo/70000001018078697"},
    {"city":"astana","name":"Infinity life","address":"–ö–∞–±–∞–Ω–±–∞–π –±–∞—Ç—ã—Ä 40, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 747 095 39 54","hours":"8-20","link":"https://2gis.kz/astana/geo/70000001054304112"},
    {"city":"astana","name":"Alion.med","address":"–ë–µ–∫—Ç—É—Ä–æ–≤–∞ 9, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 708 658 87 98","hours":"10-21","link":"https://2gis.kz/astana/geo/70000001082772168"},
    {"city":"astana","name":"–û–º—ã—Ä—Ç“õ–∞ –∫–ª–∏–Ω–∏–∫–∞—Å—ã","address":"–ê–≥—ã–±–∞–π –±–∞—Ç—ã—Ä 5, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 707 577 00 32","hours":"9-17","link":"https://2gis.kz/astana/geo/70000001030844248"},
    {"city":"astana","name":"altay clinic","address":"–°–∞—Ä–∞–π—à—ã–∫ 7, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 707 577 00 32","hours":"8-20","link":"https://2gis.kz/astana/geo/70000001038237237"},
    {"city":"astana","name":"–°–∞—É –∞—Ä“õ–∞","address":"–ê–±–∞–π –¥–∞“£“ì—ã–ª—ã, 7, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 702 098 04 89","hours":"10-17","link":"https://2gis.kz/astana/geo/70000001093606956"},
    {"city":"astana","name":"–û—Ä—Ç–æ–¥–æ–∫","address":"–ö–∞–±–∞–Ω–±–∞–π –±–∞—Ç—ã—Ä 46–∞, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 778 856 68 60","hours":"10-20","link":"https://go.2gis.com/FlKJV"},
    {"city":"astana","name":"–ú–î–° –°–ï–†–í–ò–° –ü–õ–Æ–°","address":"–¢–∞—à–µ–Ω–æ–≤–∞ 4, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 702 286 01 09","hours":"9-20","link":"https://2gis.kz/astana/geo/70000001018130407"},
    {"city":"astana","name":"–ù–µ–π—Ä–æ–¥–∏–Ω","address":"–ë–æ–∫–µ—Ö–∞–Ω–∞ 29–±, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 776 161 40 10","hours":"9-20","link":"https://2gis.kz/astana/geo/70000001026832395"},
    {"city":"astana","name":"Green clinic","address":"–•—É—Å–µ–π–Ω –±–µ–Ω –¢–∞–ª–∞–ª –∫”©—à–µ—Å—ñ, 25/1, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 747 094 26 27","hours":"8-20","link":"greenclinic.kz"},
    {"city":"astana","name":"AYANA CLINIC","address":"“ö–∞–Ω—ã—à –°–∞—Ç–ø–∞–µ–≤ –∫”©—à–µ—Å—ñ, 13/3, –ê—Å—Ç–∞–Ω–∞","lat":null,"lng":null,"phone":"+7 708 700 20 25","hours":"9-21","link":"https://go.2gis.com/SZqDQ"},

    {"city":"almaty","name":"–≠–ú–ò–†–ú–ï–î","address":"–†–æ–∑—ã–±–∞–∫–∏–µ–≤–∞ –∫”©—à–µ—Å—ñ, 37–≤, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 708 911 38 08","hours":"24/7","link":"emirmed.kz"},
    {"city":"almaty","name":"–ê“ö–º–µ–¥","address":"8-–π —ã“õ—à–∞–º–∞—É–¥–∞–Ω, 58–∞, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 707 000 00 22","hours":"24/7","link":"https://go.2gis.com/70eIc"},
    {"city":"almaty","name":"Alash expert clinic","address":"–°–µ—Ä–∫–µ–±–∞–µ–≤–∞ –¥–∞“£“ì—ã–ª—ã, 81, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 700 999 01 03","hours":"24/7","link":"https://go.2gis.com/XMF78"},
    {"city":"almaty","name":"–î–æ–∫—Ç–æ—Ä –†–∞—Ç–∏–Ω–æ–≤ –∫–ª–∏–Ω–∏–∫–∞—Å—ã","address":"–ë–∞—Å–µ–Ω–æ–≤–∞ –∫”©—à–µ—Å—ñ, 10 –∫3, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 707 514 20 26","hours":"8-20","link":"ratinovclinic.com"},
    {"city":"almaty","name":"EXPERT Neuro","address":"–ê—É—ç–∑–æ–≤–∞ –∫”©—à–µ—Å—ñ, 67, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 700 026 06 04","hours":"8-18","link":"https://go.2gis.com/A11Kc"},
    {"city":"almaty","name":"ADAM CLINIC","address":"–ê—É—ç–∑–æ–≤–∞ –∫”©—à–µ—Å—ñ, 106, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 701 840 65 00","hours":"24/7","link":"https://go.2gis.com/r2q9m"},
    {"city":"almaty","name":"–°–∞–π–≥–∞–∫ –û—Ä—Ç–æ","address":"–®–µ–≤—á–µ–Ω–∫–æ –∫”©—à–µ—Å—ñ, 148, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 775 007 22 72","hours":"9-18","link":"https://go.2gis.com/wZNzE"},
    {"city":"almaty","name":"Skolioz.kz","address":"–ù–∞—É—Ä—ã–∑–±–∞–π –±–∞—Ç—ã—Ä–∞ –∫”©—à–µ—Å—ñ, 99/1, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 707 666 22 30","hours":"9-19","link":"skolioz.kz"},
    {"city":"almaty","name":"–î–æ–∫—Ç–æ—Ä –ï–ø–∏—Ñ–∞–Ω–æ–≤ –∫–ª–∏–Ω–∏–∫–∞—Å—ã","address":"–ù–∞–≤–æ–∏ –∫”©—à–µ—Å—ñ, 208/3, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 775 006 14 97","hours":"8-20","link":"epifanovclinic.kz"},
    {"city":"almaty","name":"HealthCity","address":"–¢–∞–ª–≥–∞—Ç–∞ –ú—É—Å–∞–±–∞–µ–≤–∞ –∫”©—à–µ—Å—ñ, 8, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 775 096 75 40","hours":"8-20","link":"healthcity.kz"},
    {"city":"almaty","name":"New Star Clinic","address":"2-–π —ã“õ—à–∞–º–∞—É–¥–∞–Ω, 38–≤, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 707 141 30 62","hours":"8.30-19","link":"https://go.2gis.com/vOYHd"},
    {"city":"almaty","name":"–ì—É–ª—å-–ö–∞–Ω–∞—Ç","address":"–®—É–≥—ã–ª–∞ —ã“õ—à–∞–º–∞—É–¥–∞–Ω, 340/4 –∫5, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 701 099 00 59","hours":"8.30-17","link":"https://go.2gis.com/XqsZm"},
    {"city":"almaty","name":"A CLINIC","address":"–ñ–∞—Ä–æ–∫–æ–≤–∞ –∫”©—à–µ—Å—ñ, 275–∞, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 707 240 25 25","hours":"8-22","link":"https://go.2gis.com/cNdWT"},
    {"city":"almaty","name":"–ê–õ–ì–ê–ú–ï–î","address":"–ê–±–∞—è –¥–∞“£“ì—ã–ª—ã, 157–∞, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 707 220 68 01","hours":"24/7","link":"algamed.kz"},
    {"city":"almaty","name":"VIA Medical","address":"–¢–ª–µ–Ω–¥–∏–µ–≤–∞ –∫”©—à–µ—Å—ñ, 258–≤, –ê–ª–º–∞—Ç—ã","lat":null,"lng":null,"phone":"+7 700 610 03 03","hours":"8-21","link":"viamed.kz"},

    {"city":"shymkent","name":"Sensi","address":"–ñ–∏–±–µ–∫ –∂–æ–ª—ã 5, –®—ã–º–∫–µ–Ω—Ç","lat":null,"lng":null,"phone":"+7 702 725 00 08","hours":"9-18","link":"https://go.2gis.com/Vr0s3"},
    {"city":"shymkent","name":"Orto medic","address":"–ñ–µ–ª—Ç–æ“õ—Å–∞–Ω 29, –®—ã–º–∫–µ–Ω—Ç","lat":null,"lng":null,"phone":"+7 776 225 90 00","hours":"9-19","link":"https://go.2gis.com/gJwDs"},
    {"city":"shymkent","name":"EMIRMED","address":"–¢”©–ª–µ –±–∏ 28, –®—ã–º–∫–µ–Ω—Ç","lat":null,"lng":null,"phone":"+7 708 911 07 66","hours":"24/7","link":"emirmed.kz"},
    {"city":"shymkent","name":"Doctor plus","address":"–ë”ô–π–¥—ñ–±–µ–∫ –±–∏ 123, –®—ã–º–∫–µ–Ω—Ç","lat":null,"lng":null,"phone":"+7 705 357 51 11","hours":"8-20","link":"https://go.2gis.com/7twlJ"},
    {"city":"shymkent","name":"Omir","address":"”ò–π—Ç–µ–∫–µ –±–∏ 37, –®—ã–º–∫–µ–Ω—Ç","lat":null,"lng":null,"phone":"+7 702 150 55 44","hours":"9-18","link":"https://go.2gis.com/D2n0t"},
    {"city":"shymkent","name":"Densaulyq","address":"“ö–∞–∑—ã–±–µ–∫ –±–∏ 19, –®—ã–º–∫–µ–Ω—Ç","lat":null,"lng":null,"phone":"+7 700 222 19 19","hours":"9-18","link":"https://go.2gis.com/c3wGd"},
    {"city":"shymkent","name":"Samat","address":"–¢”ô—É–∫–µ —Ö–∞–Ω 6, –®—ã–º–∫–µ–Ω—Ç","lat":null,"lng":null,"phone":"+7 701 777 70 00","hours":"9-19","link":"https://go.2gis.com/6g3Jh"},
    {"city":"shymkent","name":"–ö–ª–∏–Ω–∏–∫–∞ vertebra","address":"–î–æ—Å—Ç—ã“õ 9, –®—ã–º–∫–µ–Ω—Ç","lat":null,"lng":null,"phone":"+7 702 222 02 02","hours":"9-19","link":"https://go.2gis.com/0O8pY"},
    {"city":"shymkent","name":"Sarbaz","address":"–†—ã—Å“õ“±–ª–±–µ–∫–æ–≤ 12, –®—ã–º–∫–µ–Ω—Ç","lat":null,"lng":null,"phone":"+7 707 202 77 77","hours":"9-18","link":"https://go.2gis.com/7oQ0D"},
    {"city":"shymkent","name":"Nurlife","address":"–ê—Å—Ç–∞–Ω–∞ 108, –®—ã–º–∫–µ–Ω—Ç","lat":null,"lng":null,"phone":"+7 701 100 10 10","hours":"9-19","link":"https://go.2gis.com/1oG4R"},

    {"city":"pavlodar","name":"Alem medical","address":"–ï—Å—Ç–∞–π 85, –ü–∞–≤–ª–æ–¥–∞—Ä","lat":null,"lng":null,"phone":"+7 778 321 22 22","hours":"9-18","link":"https://go.2gis.com/4qX2t"},
    {"city":"pavlodar","name":"–ö–ª–∏–Ω–∏–∫–∞ spine","address":"–ï—Ä—Ç—ñ—Å –¥–∞“£“ì—ã–ª—ã, 23, –ü–∞–≤–ª–æ–¥–∞—Ä","lat":null,"lng":null,"phone":"+7 705 500 55 50","hours":"9-19","link":"https://go.2gis.com/2mN8Q"},
    {"city":"pavlodar","name":"EMIRMED","address":"–ö—É—Ç—É–∑–æ–≤–∞ 44, –ü–∞–≤–ª–æ–¥–∞—Ä","lat":null,"lng":null,"phone":"+7 708 911 12 12","hours":"24/7","link":"emirmed.kz"},
    {"city":"pavlodar","name":"Orto plus","address":"–õ–æ–º–æ–≤–∞ 123, –ü–∞–≤–ª–æ–¥–∞—Ä","lat":null,"lng":null,"phone":"+7 747 777 77 77","hours":"9-18","link":"https://go.2gis.com/9Pp3p"},
    {"city":"pavlodar","name":"Rehab center","address":"–¢–æ—Ä–∞–π“ì—ã—Ä–æ–≤ 8, –ü–∞–≤–ª–æ–¥–∞—Ä","lat":null,"lng":null,"phone":"+7 776 100 10 10","hours":"9-19","link":"https://go.2gis.com/SfZqv"},
    {"city":"pavlodar","name":"Densaulyq","address":"–°”ô—Ç–±–∞–µ–≤ 19, –ü–∞–≤–ª–æ–¥–∞—Ä","lat":null,"lng":null,"phone":"+7 701 999 99 99","hours":"9-18","link":"https://go.2gis.com/7wXQy"},
    {"city":"pavlodar","name":"Medline","address":"“ö–∞–º–∑–∏–Ω 15, –ü–∞–≤–ª–æ–¥–∞—Ä","lat":null,"lng":null,"phone":"+7 707 707 07 07","hours":"8-20","link":"https://go.2gis.com/2oH3z"},
    {"city":"pavlodar","name":"Ortoped","address":"–ú–∏—Ä–∞ 30, –ü–∞–≤–ª–æ–¥–∞—Ä","lat":null,"lng":null,"phone":"+7 705 123 45 67","hours":"9-18","link":"https://go.2gis.com/1nY0p"},
    {"city":"pavlodar","name":"Spine care","address":"“ö–∞–π—ã—Ä–±–∞–µ–≤ 112, –ü–∞–≤–ª–æ–¥–∞—Ä","lat":null,"lng":null,"phone":"+7 718 266 77 88","hours":"8-20","link":"https://go.2gis.com/8vK1h"},
    {"city":"pavlodar","name":"Reforma","address":"–ù–∞–∑–∞—Ä–±–∞–µ–≤ 20, –ü–∞–≤–ª–æ–¥–∞—Ä","lat":null,"lng":null,"phone":"+7 775 000 00 01","hours":"9-19","link":"https://go.2gis.com/GkQ2m"},

    {"city":"aktau","name":"Densaulyq","address":"12-—ã“õ—à–∞–º–∞—É–¥–∞–Ω, –ê“õ—Ç–∞—É","lat":null,"lng":null,"phone":"+7 729 210 20 30","hours":"8-20","link":"https://go.2gis.com/3mQnW"},
    {"city":"aktau","name":"EMIRMED","address":"14-—ã“õ—à–∞–º–∞—É–¥–∞–Ω, –ê“õ—Ç–∞—É","lat":null,"lng":null,"phone":"+7 708 911 38 08","hours":"24/7","link":"emirmed.kz"},
    {"city":"aktau","name":"Orto med","address":"7-—ã“õ—à–∞–º–∞—É–¥–∞–Ω, –ê“õ—Ç–∞—É","lat":null,"lng":null,"phone":"+7 701 111 22 33","hours":"9-18","link":"https://go.2gis.com/0cW8K"},
    {"city":"aktau","name":"Spine rehab","address":"5-—ã“õ—à–∞–º–∞—É–¥–∞–Ω, –ê“õ—Ç–∞—É","lat":null,"lng":null,"phone":"+7 747 222 33 44","hours":"9-19","link":"https://go.2gis.com/6qT9L"},
    {"city":"aktau","name":"Clinic pro","address":"1-—ã“õ—à–∞–º–∞—É–¥–∞–Ω, –ê“õ—Ç–∞—É","lat":null,"lng":null,"phone":"+7 707 333 44 55","hours":"8-20","link":"https://go.2gis.com/8eR7Q"},
    {"city":"aktau","name":"Ortopedia","address":"9-—ã“õ—à–∞–º–∞—É–¥–∞–Ω, –ê“õ—Ç–∞—É","lat":null,"lng":null,"phone":"+7 775 444 55 66","hours":"9-18","link":"https://go.2gis.com/5gP2J"},
    {"city":"aktau","name":"Rehab center","address":"11-—ã“õ—à–∞–º–∞—É–¥–∞–Ω, –ê“õ—Ç–∞—É","lat":null,"lng":null,"phone":"+7 778 555 66 77","hours":"9-19","link":"https://go.2gis.com/7kL1S"},
    {"city":"aktau","name":"Daryger","address":"15-—ã“õ—à–∞–º–∞—É–¥–∞–Ω, –ê“õ—Ç–∞—É","lat":null,"lng":null,"phone":"+7 700 666 77 88","hours":"9-18","link":"https://go.2gis.com/4jM6A"},
    {"city":"aktau","name":"Arqa care","address":"13-—ã“õ—à–∞–º–∞—É–¥–∞–Ω, –ê“õ—Ç–∞—É","lat":null,"lng":null,"phone":"+7 705 777 88 99","hours":"9-19","link":"https://go.2gis.com/2hN3B"},
    {"city":"aktau","name":"Omir","address":"10-—ã“õ—à–∞–º–∞—É–¥–∞–Ω, –ê“õ—Ç–∞—É","lat":null,"lng":null,"phone":"+7 701 888 99 00","hours":"9-18","link":"https://go.2gis.com/9dC1V"},

    {"city":"atyrau","name":"Atyrau rehab","address":"–°”ô—Ç–ø–∞–µ–≤ 30, –ê—Ç—ã—Ä–∞—É","lat":null,"lng":null,"phone":"+7 712 223 45 67","hours":"8-20","link":"https://go.2gis.com/6bJ3P"},
    {"city":"atyrau","name":"Orto plus","address":"”ò–ª-–§–∞—Ä–∞–±–∏ 80, –ê—Ç—ã—Ä–∞—É","lat":null,"lng":null,"phone":"+7 705 123 12 12","hours":"9-18","link":"https://go.2gis.com/2aQ1R"},
    {"city":"atyrau","name":"Spine care","address":"“ö“±—Ä–º–∞–Ω“ì–∞–∑—ã 15, –ê—Ç—ã—Ä–∞—É","lat":null,"lng":null,"phone":"+7 747 111 22 33","hours":"9-19","link":"https://go.2gis.com/8cS2T"},
    {"city":"atyrau","name":"Densaulyq","address":"–ê–∑–∞—Ç—Ç—ã“õ 10, –ê—Ç—ã—Ä–∞—É","lat":null,"lng":null,"phone":"+7 701 222 33 44","hours":"9-18","link":"https://go.2gis.com/1dF7K"},
    {"city":"atyrau","name":"EMIRMED","address":"–ê—Ç—ã—Ä–∞—É, –ê—Ç—ã—Ä–∞—É","lat":null,"lng":null,"phone":"+7 708 911 07 66","hours":"24/7","link":"emirmed.kz"},
    {"city":"atyrau","name":"Medline","address":"–ù–∞–∑–∞—Ä–±–∞–µ–≤ 20, –ê—Ç—ã—Ä–∞—É","lat":null,"lng":null,"phone":"+7 777 333 44 55","hours":"8-20","link":"https://go.2gis.com/4mT0Q"},
    {"city":"atyrau","name":"Rehab center","address":"–ë–µ–π–±–∞—Ä—ã—Å 6, –ê—Ç—ã—Ä–∞—É","lat":null,"lng":null,"phone":"+7 778 444 55 66","hours":"9-19","link":"https://go.2gis.com/7nW3Z"},
    {"city":"atyrau","name":"Omir","address":"–ñ–µ“£—ñ—Å 9, –ê—Ç—ã—Ä–∞—É","lat":null,"lng":null,"phone":"+7 700 555 66 77","hours":"9-18","link":"https://go.2gis.com/5pL1X"},
    {"city":"atyrau","name":"Arqa care","address":"–î–æ—Å—Ç—ã“õ 55, –ê—Ç—ã—Ä–∞—É","lat":null,"lng":null,"phone":"+7 705 666 77 88","hours":"9-19","link":"https://go.2gis.com/3qK2V"},
    {"city":"atyrau","name":"Ortopedia","address":"–°—ã—Ä—ã–º –î–∞—Ç“±–ª—ã 1, –ê—Ç—ã—Ä–∞—É","lat":null,"lng":null,"phone":"+7 701 777 88 99","hours":"9-18","link":"https://go.2gis.com/9rH6A"},

    {"city":"karagandy","name":"Orto medic","address":"–ë“±“õ–∞—Ä –∂—ã—Ä–∞—É 5, “ö–∞—Ä–∞“ì–∞–Ω–¥—ã","lat":null,"lng":null,"phone":"+7 721 299 88 77","hours":"9-19","link":"https://go.2gis.com/8sZ2L"},
    {"city":"karagandy","name":"Rehab center","address":"–ï—Ä–º–µ–∫–æ–≤–∞ 10, “ö–∞—Ä–∞“ì–∞–Ω–¥—ã","lat":null,"lng":null,"phone":"+7 747 000 11 22","hours":"9-18","link":"https://go.2gis.com/4tH1P"},
    {"city":"karagandy","name":"Spine care","address":"–ì–æ–≥–æ–ª—å 20, “ö–∞—Ä–∞“ì–∞–Ω–¥—ã","lat":null,"lng":null,"phone":"+7 701 111 22 33","hours":"9-19","link":"https://go.2gis.com/2uJ6K"},
    {"city":"karagandy","name":"Densaulyq","address":"–ú“±“õ–∞–Ω–æ–≤ 12, “ö–∞—Ä–∞“ì–∞–Ω–¥—ã","lat":null,"lng":null,"phone":"+7 705 222 33 44","hours":"8-20","link":"https://go.2gis.com/1vQ7R"},
    {"city":"karagandy","name":"EMIRMED","address":"“ö–∞—Ä–∞“ì–∞–Ω–¥—ã, “ö–∞—Ä–∞“ì–∞–Ω–¥—ã","lat":null,"lng":null,"phone":"+7 708 911 12 12","hours":"24/7","link":"emirmed.kz"},
    {"city":"karagandy","name":"Medline","address":"–°–µ–π—Ñ—É–ª–ª–∏–Ω 18, “ö–∞—Ä–∞“ì–∞–Ω–¥—ã","lat":null,"lng":null,"phone":"+7 777 444 55 66","hours":"9-19","link":"https://go.2gis.com/6wD2T"},
    {"city":"karagandy","name":"Ortopedia","address":"–ù–∞–∑–∞—Ä–±–∞–µ–≤ 30, “ö–∞—Ä–∞“ì–∞–Ω–¥—ã","lat":null,"lng":null,"phone":"+7 778 555 66 77","hours":"9-18","link":"https://go.2gis.com/0xC5V"},
    {"city":"karagandy","name":"Arqa care","address":"–¢”ô—Ç—Ç—ñ–º–±–µ—Ç 7, “ö–∞—Ä–∞“ì–∞–Ω–¥—ã","lat":null,"lng":null,"phone":"+7 700 666 77 88","hours":"9-19","link":"https://go.2gis.com/3yB1X"},
    {"city":"karagandy","name":"Omir","address":"–ñ–µ“£—ñ—Å 1, “ö–∞—Ä–∞“ì–∞–Ω–¥—ã","lat":null,"lng":null,"phone":"+7 701 777 88 99","hours":"9-18","link":"https://go.2gis.com/9zA2Q"},
    {"city":"karagandy","name":"Clinic pro","address":"–ê–±–∞–π 7, “ö–∞—Ä–∞“ì–∞–Ω–¥—ã","lat":null,"lng":null,"phone":"+7 705 888 99 00","hours":"9-19","link":"https://go.2gis.com/5aS6M"},

    {"city":"taraz","name":"Taraz rehab","address":"–¢”©–ª–µ –±–∏ 1, –¢–∞—Ä–∞–∑","lat":null,"lng":null,"phone":"+7 726 234 56 78","hours":"9-19","link":"https://go.2gis.com/4bQ9T"},
    {"city":"taraz","name":"Orto med","address":"–°”ô—Ç–ø–∞–µ–≤ 13, –¢–∞—Ä–∞–∑","lat":null,"lng":null,"phone":"+7 708 700 20 25","hours":"9-21","link":"https://go.2gis.com/SZqDQ"},
    {"city":"taraz","name":"Spine care","address":"–ê–±—ã–ª–∞–π —Ö–∞–Ω 100, –¢–∞—Ä–∞–∑","lat":null,"lng":null,"phone":"+7 724 256 78 90","hours":"9-18","link":"https://go.2gis.com/7cW1P"},
    {"city":"taraz","name":"Densaulyq","address":"–ñ–∞–º–±—ã–ª 20, –¢–∞—Ä–∞–∑","lat":null,"lng":null,"phone":"+7 701 111 22 33","hours":"8-20","link":"https://go.2gis.com/2dE3K"},
    {"city":"taraz","name":"EMIRMED","address":"–¢–∞—Ä–∞–∑, –¢–∞—Ä–∞–∑","lat":null,"lng":null,"phone":"+7 708 911 07 66","hours":"24/7","link":"emirmed.kz"},
    {"city":"taraz","name":"Medline","address":"“ö–æ–π–≥–µ–ª–¥—ñ 6, –¢–∞—Ä–∞–∑","lat":null,"lng":null,"phone":"+7 747 222 33 44","hours":"9-19","link":"https://go.2gis.com/8eR2L"},
    {"city":"taraz","name":"Ortopedia","address":"–ê–π—Ç–µ–∫–µ –±–∏ 9, –¢–∞—Ä–∞–∑","lat":null,"lng":null,"phone":"+7 777 333 44 55","hours":"9-18","link":"https://go.2gis.com/1fT6A"},
    {"city":"taraz","name":"Rehab center","address":"–ñ—ñ–±–µ–∫ –∂–æ–ª—ã 5, –¢–∞—Ä–∞–∑","lat":null,"lng":null,"phone":"+7 778 444 55 66","hours":"9-19","link":"https://go.2gis.com/3gP1X"},
    {"city":"taraz","name":"Arqa care","address":"–î–æ—Å—Ç—ã“õ 55, –¢–∞—Ä–∞–∑","lat":null,"lng":null,"phone":"+7 700 555 66 77","hours":"9-18","link":"https://go.2gis.com/6hJ2V"},
    {"city":"taraz","name":"Omir","address":"–¢”ô—É–∫–µ —Ö–∞–Ω 6, –¢–∞—Ä–∞–∑","lat":null,"lng":null,"phone":"+7 701 666 77 88","hours":"9-19","link":"https://go.2gis.com/9iK3Q"},

    {"city":"oskemen","name":"Oskemen rehab","address":"“ö–∞–∑–∞“õ—Å—Ç–∞–Ω –∫”©—à–µ—Å—ñ, 40, ”®—Å–∫–µ–º–µ–Ω","lat":null,"lng":null,"phone":"+7 723 255 55 55","hours":"8-20","link":"https://go.2gis.com/2jM0P"},
    {"city":"oskemen","name":"Orto med","address":"–ê–±–∞–π 150, ”®—Å–∫–µ–º–µ–Ω","lat":null,"lng":null,"phone":"+7 716 223 45 67","hours":"9-18","link":"https://go.2gis.com/3kL1X"},
    {"city":"oskemen","name":"Spine care","address":"–ù–∞–∑–∞—Ä–±–∞–µ–≤ 20, ”®—Å–∫–µ–º–µ–Ω","lat":null,"lng":null,"phone":"+7 747 111 22 33","hours":"9-19","link":"https://go.2gis.com/4lN2V"},
    {"city":"oskemen","name":"Densaulyq","address":"–î–æ—Å—Ç—ã“õ 10, ”®—Å–∫–µ–º–µ–Ω","lat":null,"lng":null,"phone":"+7 701 222 33 44","hours":"9-18","link":"https://go.2gis.com/5mP3Q"},
    {"city":"oskemen","name":"EMIRMED","address":"”®—Å–∫–µ–º–µ–Ω, ”®—Å–∫–µ–º–µ–Ω","lat":null,"lng":null,"phone":"+7 708 911 12 12","hours":"24/7","link":"emirmed.kz"},
    {"city":"oskemen","name":"Medline","address":"–¢”ô—É–µ–ª—Å—ñ–∑–¥—ñ–∫ 50, ”®—Å–∫–µ–º–µ–Ω","lat":null,"lng":null,"phone":"+7 777 333 44 55","hours":"8-20","link":"https://go.2gis.com/6nQ4T"},
    {"city":"oskemen","name":"Ortopedia","address":"–ñ–µ“£—ñ—Å 1, ”®—Å–∫–µ–º–µ–Ω","lat":null,"lng":null,"phone":"+7 778 444 55 66","hours":"9-19","link":"https://go.2gis.com/7oR5K"},
    {"city":"oskemen","name":"Rehab center","address":"–°”ô—Ç–ø–∞–µ–≤ 20, ”®—Å–∫–µ–º–µ–Ω","lat":null,"lng":null,"phone":"+7 700 555 66 77","hours":"9-18","link":"https://go.2gis.com/8pS6M"},
    {"city":"oskemen","name":"Arqa care","address":"–ú–µ—Ç–∞–ª–ª—É—Ä–≥—Ç–µ—Ä 1, ”®—Å–∫–µ–º–µ–Ω","lat":null,"lng":null,"phone":"+7 701 666 77 88","hours":"9-19","link":"https://go.2gis.com/9qT7L"},
    {"city":"oskemen","name":"Omir","address":"–ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è 60, ”®—Å–∫–µ–º–µ–Ω","lat":null,"lng":null,"phone":"+7 705 777 88 99","hours":"9-18","link":"https://go.2gis.com/0rU8A"},

    {"city":"semey","name":"Semei rehab","address":"–õ–µ–Ω–∏–Ω 20, –°–µ–º–µ–π","lat":null,"lng":null,"phone":"+7 722 240 30 20","hours":"9-19","link":"https://go.2gis.com/1sV2Q"},
    {"city":"semey","name":"Orto med","address":"–ê–±–∞–π 150, –°–µ–º–µ–π","lat":null,"lng":null,"phone":"+7 716 223 45 67","hours":"9-18","link":"https://go.2gis.com/2tW3K"},
    {"city":"semey","name":"Spine care","address":"–ê–±—ã–ª–∞–π —Ö–∞–Ω 100, –°–µ–º–µ–π","lat":null,"lng":null,"phone":"+7 724 256 78 90","hours":"9-19","link":"https://go.2gis.com/3uX4M"},
    {"city":"semey","name":"Densaulyq","address":"–ñ–µ“£—ñ—Å 9, –°–µ–º–µ–π","lat":null,"lng":null,"phone":"+7 701 111 22 33","hours":"9-18","link":"https://go.2gis.com/4vY5L"},
    {"city":"semey","name":"EMIRMED","address":"–°–µ–º–µ–π, –°–µ–º–µ–π","lat":null,"lng":null,"phone":"+7 708 911 07 66","hours":"24/7","link":"emirmed.kz"},
    {"city":"semey","name":"Medline","address":"–î–æ—Å—Ç—ã“õ 55, –°–µ–º–µ–π","lat":null,"lng":null,"phone":"+7 747 222 33 44","hours":"8-20","link":"https://go.2gis.com/5wZ6A"},
    {"city":"semey","name":"Ortopedia","address":"–°”ô—Ç–ø–∞–µ–≤ 13, –°–µ–º–µ–π","lat":null,"lng":null,"phone":"+7 777 333 44 55","hours":"9-19","link":"https://go.2gis.com/6xA7P"},
    {"city":"semey","name":"Rehab center","address":"–¢”ô—É–∫–µ —Ö–∞–Ω 6, –°–µ–º–µ–π","lat":null,"lng":null,"phone":"+7 778 444 55 66","hours":"9-18","link":"https://go.2gis.com/7yB8T"},
    {"city":"semey","name":"Arqa care","address":"“ö–∞–∑—ã–±–µ–∫ –±–∏ 19, –°–µ–º–µ–π","lat":null,"lng":null,"phone":"+7 700 555 66 77","hours":"9-19","link":"https://go.2gis.com/8zC9V"},
    {"city":"semey","name":"Omir","address":"”ò–π—Ç–µ–∫–µ –±–∏ 37, –°–µ–º–µ–π","lat":null,"lng":null,"phone":"+7 701 666 77 88","hours":"9-18","link":"https://go.2gis.com/9aD0Q"}
  ];

  let activeCity = "astana";
  let userPos = null;
  let markersLayer = null;
  let userMarker = null;

  const map = L.map("map", { zoomControl:true, scrollWheelZoom:false, preferCanvas:true });
  L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png", { maxZoom: 19, attribution: "&copy; OpenStreetMap &copy; CARTO" }).addTo(map);
  markersLayer = L.layerGroup().addTo(map);

  function normalize(s){ return (s||"").toString().toLowerCase().trim(); }

  function toTel(phone){
    const first = (phone||"").split(",")[0].trim();
    const cleaned = first.replace(/[^\d+]/g,"");
    return cleaned ? `tel:${cleaned}` : null;
  }

  function safeLink(url){
    if(!url) return null;
    const u = url.toString().trim();
    if (!u) return null;
    return u.startsWith("http") ? u : `https://${u}`;
  }

  function routeLink(c){
    if (c.lat != null && c.lng != null){
      if (userPos){
        const o = `${userPos.lat},${userPos.lng}`;
        const d = `${c.lat},${c.lng}`;
        return `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(o)}&destination=${encodeURIComponent(d)}&travelmode=driving`;
      }
      return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(`${c.lat},${c.lng}`)}`;
    }
    return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(c.address)}`;
  }

  function pad2(n){ return String(n).padStart(2,"0"); }

  function formatHours(raw){
    const s = (raw||"").toString().trim();
    if(!s) return "";
    if (s.toLowerCase() === "24/7") return "24/7";

    const cleaned = s.replace(/\s+/g,"").replace(/‚Äì/g,"-").replace(/‚Äî/g,"-");
    const parts = cleaned.split("-");
    if (parts.length !== 2) return s;

    const parseTime = (t) => {
      if (!t) return null;
      const tt = t.replace(",",".");
      if (tt.includes(":")){
        const [h,m] = tt.split(":");
        const hh = Number(h);
        const mm = Number(m || "0");
        if (!Number.isFinite(hh) || !Number.isFinite(mm)) return null;
        return `${pad2(hh)}:${pad2(mm)}`;
      }
      if (tt.includes(".")){
        const [h,m] = tt.split(".");
        const hh = Number(h);
        const mm = Number(m || "0");
        if (!Number.isFinite(hh) || !Number.isFinite(mm)) return null;
        return `${pad2(hh)}:${pad2(mm)}`;
      }
      const hh = Number(tt);
      if (!Number.isFinite(hh)) return null;
      return `${pad2(hh)}:00`;
    };

    const a = parseTime(parts[0]);
    const b = parseTime(parts[1]);
    if (!a || !b) return s;
    return `${a}-${b}`;
  }

  function haversineKm(a, b){
    const R = 6371;
    const toRad = x => x * Math.PI / 180;
    const dLat = toRad(b.lat - a.lat);
    const dLng = toRad(b.lng - a.lng);
    const lat1 = toRad(a.lat);
    const lat2 = toRad(b.lat);
    const h = Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLng/2)**2;
    return 2*R*Math.asin(Math.sqrt(h));
  }

  function setStatus(text){
    document.getElementById("statusLine").textContent = text || "";
  }

  function buildCityButtons(){
    const wrap = document.getElementById("cityButtons");
    wrap.innerHTML = "";
    Object.entries(cityCenters).forEach(([key, meta]) => {
      const btn = document.createElement("button");
      btn.className = "city-btn px-4 py-2 rounded-full border border-gray-200 font-semibold text-sm hover:bg-gray-50 transition";
      btn.dataset.city = key;
      btn.textContent = meta.name;
      btn.addEventListener("click", () => {
        document.querySelectorAll(".city-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        setCity(key);
      });
      wrap.appendChild(btn);
    });
  }

  function setCity(cityKey){
    activeCity = cityKey;
    userPos = null;
    if (userMarker){
      map.removeLayer(userMarker);
      userMarker = null;
    }
    document.getElementById("searchInput").value = "";
    setStatus("");
    const meta = cityCenters[activeCity];
    document.getElementById("mapTitle").textContent = meta.name;
    map.setView(meta.center, meta.zoom);
    render();
    geocodeMissingForCity(activeCity);
  }

  function getVisibleList(){
    const q = normalize(document.getElementById("searchInput").value);
    let list = clinics.filter(c => c.city === activeCity);

    if (q){
      list = list.filter(c => {
        const hay = [c.name, c.address, c.phone, c.hours].map(normalize).join(" | ");
        return hay.includes(q);
      });
    }

    if (userPos){
      const withDist = [];
      const without = [];
      list.forEach(c => {
        if (c.lat != null && c.lng != null){
          const d = haversineKm({lat:userPos.lat, lng:userPos.lng}, {lat:c.lat, lng:c.lng});
          withDist.push({ ...c, _dist:d });
        } else {
          without.push(c);
        }
      });
      withDist.sort((a,b) => a._dist - b._dist);
      return [...withDist, ...without];
    }

    return list.sort((a,b) => a.name.localeCompare(b.name, "kk"));
  }

  function render(){
    const list = getVisibleList();
    document.getElementById("countBadge").textContent = `${list.length} –æ—Ä—ã–Ω`;

    const wrap = document.getElementById("clinicList");
    const empty = document.getElementById("emptyBox");
    wrap.innerHTML = "";
    empty.classList.toggle("hidden", list.length !== 0);

    markersLayer.clearLayers();
    const bounds = [];

    list.forEach((c, idx) => {
      const hours = formatHours(c.hours);
      const tel = toTel(c.phone);
      const link = safeLink(c.link);
      const route = routeLink(c);
      const dist = (c._dist != null) ? `${c._dist.toFixed(1)} –∫–º` : "";

      const card = document.createElement("div");
      card.className = "border border-gray-100 rounded-2xl p-4 hover:shadow-sm transition";

      card.innerHTML = `
        <div class="flex items-start justify-between gap-3">
          <div>
            <h3 class="text-lg font-extrabold text-gray-900 leading-snug">
              <i class="fa-solid fa-hospital text-[var(--accent)] mr-2"></i>${c.name}
            </h3>
            <div class="mt-2 text-sm text-gray-700 flex items-start gap-2">
              <i class="fa-solid fa-location-dot text-red-500 mt-0.5"></i>
              <span>${c.address}</span>
            </div>
            ${hours ? `
              <div class="mt-2 text-sm text-gray-700 flex items-start gap-2">
                <i class="fa-solid fa-clock text-gray-500 mt-0.5"></i>
                <span>${hours}</span>
              </div>` : ""}
            ${c.phone ? `
              <div class="mt-2 text-sm text-gray-700 flex items-start gap-2">
                <i class="fa-solid fa-phone text-emerald-600 mt-0.5"></i>
                <span>${c.phone}</span>
              </div>` : ""}
          </div>
          ${dist ? `<span class="text-xs font-bold bg-gray-900 text-white px-2 py-1 rounded-full whitespace-nowrap">${dist}</span>` : ""}
        </div>

        <div class="mt-4 flex flex-wrap gap-2">
          ${tel ? `
            <a class="px-3 py-2 rounded-xl bg-gray-900 text-white font-bold text-xs hover:opacity-90 transition" href="${tel}">
              “ö–æ“£—ã—Ä–∞—É —à–∞–ª—É
            </a>` : ""}
          <a class="px-3 py-2 rounded-xl border border-gray-200 font-bold text-xs hover:bg-gray-50 transition" href="${route}" target="_blank" rel="noopener">
            –ú–∞—Ä—à—Ä—É—Ç
          </a>
          ${link ? `
            <a class="px-3 py-2 rounded-xl border border-gray-200 font-bold text-xs hover:bg-gray-50 transition" href="${link}" target="_blank" rel="noopener">
              –°–∞–π—Ç / 2GIS
            </a>` : ""}
          <button class="px-3 py-2 rounded-xl border border-gray-200 font-bold text-xs hover:bg-gray-50 transition" data-focus="${idx}">
            –ö–∞—Ä—Ç–∞–¥–∞
          </button>
        </div>
      `;

      wrap.appendChild(card);

      const focusBtn = card.querySelector(`button[data-focus="${idx}"]`);

      if (c.lat != null && c.lng != null){
        const m = L.marker([c.lat, c.lng]).addTo(markersLayer);
        m.bindPopup(`<b>${c.name}</b><br>${c.address}`);
        bounds.push([c.lat, c.lng]);

        focusBtn.addEventListener("click", () => {
          map.setView([c.lat, c.lng], 15, { animate:true });
          m.openPopup();
        });
      } else {
        focusBtn.addEventListener("click", () => {
          setStatus("–ö–∞—Ä—Ç–∞ –Ω“Ø–∫—Ç–µ–ª–µ—Ä—ñ –∂“Ø–∫—Ç–µ–ª—ñ–ø –∂–∞—Ç—ã—Ä. –ë—ñ—Ä —Å”ô—Ç –∫“Ø—Ç—ñ“£—ñ–∑.");
        });
      }
    });

    if (bounds.length > 1){
      map.fitBounds(bounds, { padding:[30,30] });
    } else if (bounds.length === 1){
      map.setView(bounds[0], 14);
    } else {
      const meta = cityCenters[activeCity];
      map.setView(meta.center, meta.zoom);
    }
  }

  async function geocodeOne(c){
    const key = `arqa_geo_${c.city}_${c.name}_${c.address}`;
    const cached = localStorage.getItem(key);
    if (cached){
      try{
        const obj = JSON.parse(cached);
        if (typeof obj.lat === "number" && typeof obj.lng === "number"){
          c.lat = obj.lat;
          c.lng = obj.lng;
          return true;
        }
      }catch(e){}
    }

    const q = encodeURIComponent(`${c.address}, Kazakhstan`);
    const url = `https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${q}`;

    try{
      const res = await fetch(url, { headers:{ "Accept":"application/json" } });
      if (!res.ok) return false;
      const data = await res.json();
      if (!Array.isArray(data) || !data[0]) return false;

      const lat = Number(data[0].lat);
      const lng = Number(data[0].lon);
      if (!Number.isFinite(lat) || !Number.isFinite(lng)) return false;

      c.lat = lat;
      c.lng = lng;
      localStorage.setItem(key, JSON.stringify({lat, lng}));
      return true;
    }catch(e){
      return false;
    }
  }

  async function geocodeMissingForCity(cityKey){
    const list = clinics.filter(x => x.city === cityKey && (x.lat == null || x.lng == null));
    if (!list.length) return;

    setStatus("–ö–∞—Ä—Ç–∞ –Ω“Ø–∫—Ç–µ–ª–µ—Ä—ñ –∂“Ø–∫—Ç–µ–ª—ñ–ø –∂–∞—Ç—ã—Ä...");
    for (const c of list){
      await geocodeOne(c);
      if (c.city === activeCity) render();
      await new Promise(r => setTimeout(r, 900));
    }
    setStatus("");
  }

  function nearMe(){
    setStatus("");
    if (!navigator.geolocation){
      setStatus("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –±“±–ª “õ“±—Ä—ã–ª“ì—ã–¥–∞ “õ–æ–ª–∂–µ—Ç—ñ–º—Å—ñ–∑.");
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        userPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };

        if (userMarker){
          map.removeLayer(userMarker);
          userMarker = null;
        }

        userMarker = L.circleMarker([userPos.lat, userPos.lng], {
          radius: 7,
          weight: 2,
          color: "#02204f",
          fillColor: "#4a6fa5",
          fillOpacity: 0.25
        }).addTo(map).bindPopup("–°—ñ–∑ –æ—Å—ã–Ω–¥–∞—Å—ã–∑");

        map.setView([userPos.lat, userPos.lng], 13, { animate:true });
        userMarker.openPopup();

        render();
        setStatus("–ñ–∞“õ—ã–Ω –æ—Ä—ã–Ω–¥–∞—Ä –∂–æ“ì–∞—Ä—ã–¥–∞ –∫”©—Ä—Å–µ—Ç—ñ–ª–¥—ñ.");
      },
      (err) => {
        const msg = err && err.code === 1 ? "–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è“ì–∞ —Ä“±“õ—Å–∞—Ç –±–µ—Ä—ñ–ª–º–µ–¥—ñ." : "–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∞–Ω—ã“õ—Ç–∞–ª–º–∞–¥—ã. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç/“õ“±—Ä—ã–ª“ì—ã –±–∞–ø—Ç–∞—É–ª–∞—Ä—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑.";
        setStatus(msg);
      },
      { enableHighAccuracy:true, timeout:12000, maximumAge:60000 }
    );
  }

  document.addEventListener("DOMContentLoaded", () => {
    buildCityButtons();
    const firstBtn = document.querySelector(`.city-btn[data-city="${activeCity}"]`);
    if (firstBtn) firstBtn.classList.add("active");

    const meta = cityCenters[activeCity];
    document.getElementById("mapTitle").textContent = meta.name;
    map.setView(meta.center, meta.zoom);

    document.getElementById("searchInput").addEventListener("input", () => render());
    document.getElementById("nearMeBtn").addEventListener("click", () => nearMe());

    render();
    geocodeMissingForCity(activeCity);
  });
</script>

</body>
</html>
